<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../favicon.ico">
  
  <title>App Data Framework - DataTorrent Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "App Data Framework";
    var mkdocs_page_input_path = "app_data_framework.md";
    var mkdocs_page_url = "/app_data_framework/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44586211-2', 'docs.datatorrent.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> DataTorrent Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">DataTorrent RTS</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Demos</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../demos/">Running Apps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sandbox/">Sandbox</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cloud Integration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../aws_emr_manual/">AWS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../create/">Creating Applications</a>
                </li>
                <li class="">
                    
    <a class="" href="../beginner/">Beginner's Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../demo_videos/">Videos</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <span class="caption-text">Top N Words</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords/">Introduction</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c1/">Development Environment</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c2/">Building in Java</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c3/">Building with dtAssemble</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c4/">Monitoring with dtManage</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c5/">Visualizing with dtDashboard</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c7/">Advanced Features</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c6/">Appendix</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Sales Dimensions</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions/">Building in Java</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions-c2/">Building with dtAssemble</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions-c3/">Visualizing with dtDashboard</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions-c4/">Monitoring with dtManage</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../apex_development_setup/">Apex Development Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../configure_IDE/">Generate New Project in IDE</a>
                </li>
                <li class="">
                    
    <a class="" href="../application_development/">Applications</a>
                </li>
                <li class="">
                    
    <a class="" href="../application_packages/">Application Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration_packages/">Configuration Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../operator_development/">Operators</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Library Operators</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../library_operators/">List of Operators</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/block_reader/">Block Reader</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/deduper/">Deduper</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/dimensions_computation/">Dimension Computation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/file_output/">File Output</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/file_splitter/">File Splitter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/hdht/">HDHT</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/kafkaInputOperator/">Kafka Input</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/snapshot_server/">Snapshot Server</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">App Data Framework</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#app-data-framework-user-guide">App Data Framework User Guide</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#introduction">Introduction</a></li>
        
            <li><a class="toctree-l4" href="#examples">Examples</a></li>
        
            <li><a class="toctree-l4" href="#architecture-overview">Architecture Overview</a></li>
        
            <li><a class="toctree-l4" href="#technical-details">Technical Details</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_api/">REST API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">App Templates</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">0.10.0</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/common/import-launch/">Import and Launch App-template</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/common/customize/">Customizing an app-template</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/database-to-database-sync/">Database-to-database-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/hdfs-line-copy/">HDFS-line-copy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/hdfs-part-file-copy/">HDFS-part-file-copy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/hdfs-to-hdfs-filter-transform/">HDFS-to-HDFS-filter-transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-cassandra-filter-transform/">Kafka-to-Cassandra-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-database-sync/">Kafka-to-Database-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-hdfs-filter-transform/">Kafka-to-HDFS-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-kafka-filter-transform/">Kafka-to-Kafka-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kinesis-to-redshift/">Kinesis-to-Redshift</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kinesis-to-s3/">Kinesis-to-S3</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/s3-to-hdfs-sync/">S3-to-HDFS-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/s3-to-redshift/">S3-to-HDFS-Filter-Transform</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/database-to-hdfs/">Database dump to HDFS App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/database-to-database-sync/">Database to Database Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-sync/">HDFS Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-line-copy/">HDFS to HDFS Line Copy App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-to-kafka-sync/">HDFS to Kafka Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-to-s3-sync/">HDFS to S3 Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kafka-to-database-sync/">Kafka to Database Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kafka-to-hdfs-filter/">Kafka to HDFS Filter App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kafka-to-hdfs-sync/">Kafka to HDFS Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kinesis-to-s3/">Kinesis to S3 App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/s3-to-hdfs-sync/">S3 to HDFS Sync App</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../app_data_tracker/">App Data Tracker</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtingest/">dtIngest</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Platform</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../rts/">RTS</a>
                </li>
                <li class="">
                    
    <a class="" href="../application_configurations/">Application Configurations</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtmanage/">dtManage</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtassemble/">dtAssemble</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtdashboard/">dtDashboard</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway/">dtGateway</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_systemalerts/">Alerts</a>
                </li>
                <li class="">
                    
    <a class="" href="../apex/">Apache Apex</a>
                </li>
                <li class="">
                    
    <a class="" href="../apex_malhar/">Apache Apex-Malhar</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deployment and Operations</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/">Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_security/">Security</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_systemalerts/">System Alerts</a>
                </li>
                <li class="">
                    
    <a class="" href="../apexcli/">Apex CLI</a>
                </li>
                <li class="">
                    
    <a class="" href="../troubleshooting/">Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../release_notes/">Release Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../glossary/">Glossary</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../additional_docs/">Resources</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">DataTorrent Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>App Data Framework</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="app-data-framework-user-guide">App Data Framework User Guide</h1>
<h2 id="introduction">Introduction</h2>
<p>The App Data Framework provides a way for data in Apex applications to be queried and delivered, so that the end user can easily access the application data and visualize it. </p>
<p>In this document, we will first look at a simple example of how an application developer can quickly add this capability to an application. We will then explore the basic building blocks of the App Data Framework, and the data schemas that Apache Apex and DataTorrent RTS support.</p>
<p>This document assumes that the reader has the basic knowledge of Apache Apex.</p>
<h2 id="examples">Examples</h2>
<h3 id="a-simple-example">A Simple Example</h3>
<p>In Apache Apex Malhar, the Twitter example demonstrates the usage of the App Data Framework. The application calculates top 10 hashtags mentioned in tweets in the last 5 minutes across a 1% random tweet sampling on a rolling window basis.</p>
<p>In DataTorrent RTS, you can create a dashboard for this Twitter application that has a bar chart widget with the current top hashtags in Twitter constantly updated:</p>
<p><img alt="Twitter Widget" src="../images/app_data_framework/twitter_widget.gif" /></p>
<p>The topology of the Twitter example looks like this:</p>
<p><img alt="Twitter Topology" src="../images/app_data_framework/twitter_topology.png" /></p>
<p>The <em>SnapshotServer</em> operator (along with a Query Operator embedded in it) and the <em>QueryResult</em> operator enable the latest Twitter top hashtags to be visualizable in the widget. </p>
<p>We will explain them in the following sections.</p>
<p>The code of this Twitter example with App Data support is available <a href="https://github.com/apache/incubator-apex-malhar/blob/master/demos/twitter/src/main/java/com/datatorrent/demos/twitter/TwitterTrendingHashtagsApplication.java">here</a></p>
<h3 id="a-more-complicated-example">A More Complicated Example</h3>
<p>In DataTorrent RTS, the Sales example demonstrates a more complicated usage of the App Data Framework. The application generates random sales events, which has dimension keys of sales channels, region and products. Then it aggregates tax, sales amount and discount across all the key combinations.</p>
<p><img alt="Sales Widget" src="../images/app_data_framework/sales_widget.gif" /></p>
<p>The topology of the Sales example looks like this:</p>
<p><img alt="Sales Topology" src="../images/app_data_framework/sales_topology.png" /></p>
<p>Similar to the Twitter example, the <em>Store</em> operator along with the Query Operator embedded in it, and the <em>QueryResult</em> operator enable the data to be queried and be delivered to the widget for visualization.</p>
<p>The code of this Sales example is available <a href="https://github.com/DataTorrent/examples/tree/master/dt-demo/dimensions/src/main/java/com/datatorrent/demos/dimensions/sales/generic">here</a></p>
<h2 id="architecture-overview">Architecture Overview</h2>
<p>At a very high level, this is the architecture diagram for the App Data Framework. We will explain each of the components.</p>
<p><img alt="Architecture" src="../images/app_data_framework/architecture.png" /></p>
<h3 id="app-data-source">App Data Source</h3>
<p>Each App Data Source is a queryable unit, and it is represented by three operators in your application. It is possible to have multiple such App Data Sources in one application.</p>
<p><img alt="App Data Source" src="../images/app_data_framework/app_data_source.png" /></p>
<h4 id="data-source">Data Source</h4>
<p>The Data Source Operator that runs in an Apex application that processes the queries from the Query Operator and gives back the results. In the Twitter example, it is the <em>Snapshot Server</em> operator. The Java class of this operator is <code>com.datatorrent.lib.appdata.snapshot.AppDataSnapshotServerMap</code> in Apex Malhar. In the Sales example, it is the <em>Store</em> operator. The Java class of this operator is <code>com.datatorrent.contrib.dimensions.AppDataSingleSchemaDimensionStoreHDHT</code>, which is provided by DataTorrent RTS.</p>
<h4 id="query-operator">Query Operator</h4>
<p>The Query Operator runs embedded in the Data Source Operator, listens for incoming queries from the Message Bus and hands it over to the Data Source Operator. Note that since the Query Operator is embedded within the Data Source Operator, it will not be visible in the DAG view in <a href="http://docs.datatorrent.com/dtmanage/">dtManage</a>. In both the Twitter and the Sales examples, the Java class that implements the Query Operator is <code>com.datatorrent.lib.io.PubSubWebSocketAppDataQuery</code>.</p>
<h4 id="result-operator">Result Operator</h4>
<p>The Result Operator runs in an Apex application that publishes the results from the Data Source Operator to the Message Bus. In the Twitter example, it is the <em>QueryResult</em> operator. The Java class of this operator in both the Twitter and Sales examples is <code>com.datatorrent.lib.io.PubSubWebSocketAppDataResult</code>.</p>
<h3 id="message-bus">Message Bus</h3>
<p>Because the operators can run in any node in the cluster, a Message Bus with a pub-sub mechanism is used for delivery for both the queries and the results. This mechanism requires that the caller sends the query message to a topic that the Query Operator listens to, and the Result Operator sends the query result message passed from the Data Source Operator to a different topic that the caller listens to. Typically, the caller is a web browser.</p>
<p>In DataTorrent RTS, this mechanism is provided by <a href="http://docs.datatorrent.com/dtgateway/">dtGateway</a>. It uses WebSocket to achieve this so that the queries can be made and the results can be processed directly by a web browser. </p>
<p>Referring back to the architecture diagram, the web browser, the Query Operator and the Result Operator all connect to dtGateway via WebSocket, with a pub-sub protocol on top of it.</p>
<h3 id="schemas">Schemas</h3>
<p>Each App Data Source must provide a schema that describes what is a valid data query and what is a valid data response, so that the caller knows how to query and how to interpret the response from the App Data Sources. We will describe two schemas that underlie the Twitter example and the Sales example.</p>
<h3 id="ui-widgets">UI Widgets</h3>
<p>In order to allow the end users to visualize the result data in a web browser, we need web-based UI widgets that take user input and send the queries and display the results according to the App Data Sources’ schemas. In DataTorrent RTS, we have a number of UI widgets built in. We will also describe how a user can write their own custom widgets.</p>
<h2 id="technical-details">Technical Details</h2>
<h3 id="app-data-source_1">App Data Source</h3>
<p>As described in the overview, an App Data Source consists of three operators: Data Source, Query and Result.</p>
<p>The Result Operator must implement this interface in <code>com.datatorrent.common.experimental.AppData</code>:</p>
<pre><code class="java">interface ConnectionInfoProvider 
{
  String getAppDataUrl();
  String getTopic();
}
</code></pre>

<p>The Query Operator, which is embedded in the Data Store Operator, must implement this interface in <code>com.datatorrent.common.experimental.AppData</code>:</p>
<pre><code class="java">interface EmbeddableQueryInfoProvider&lt;QUERY_TYPE&gt; extends Operator, ConnectionInfoProvider, Operator.ActivationListener&lt;OperatorContext&gt;
{
  DefaultOutputPort&lt;QUERY_TYPE&gt; getOutputPort();

  void enableEmbeddedMode();
}
</code></pre>

<p>The port that is returned by the embedded Query Operator’s <code>getOutputPort()</code> method will be connected to the input port of the Data Source Operator that is annotated with the marker annotation <code>com.datatorrent.common.experimental.AppData.QueryPort</code>.</p>
<p>On the DAG level, the Result Operator needs to connect to an output port of the Data Source Operator that is annotated with the marker annotation <code>com.datatorrent.common.experimental.AppData.ResultPort</code>. </p>
<p>With this setup, the Data Source, along with the query topic and the result topic, will be discoverable by STRAM. STRAM will return the information to the caller via its REST API.</p>
<p>Below is the App Data Source discovery information returned by the <code>/ws/v2/applications/{appid}</code> REST call from dtGateway for the Twitter example:</p>
<pre><code>{
  ...
  &quot;appDataSources&quot;: [
    {
      &quot;name&quot;: &quot;SnapshotServer.queryResult&quot;,
      &quot;operatorName&quot;: &quot;SnapshotServer&quot;,
      &quot;portName&quot;: &quot;queryResult&quot;,
      &quot;query&quot;: {
        &quot;operatorName&quot;: &quot;SnapshotServer.query&quot;,
        &quot;topic&quot;: &quot;TwitterHashtagQueryDemo&quot;,
        &quot;url&quot;: &quot;pubsub&quot;
      },
      &quot;result&quot;: {
        &quot;appendQIDToTopic&quot;: true,
        &quot;operatorName&quot;: &quot;QueryResult&quot;,
        “topic&quot;: &quot;TwitterHashtagQueryResultDemo&quot;,
        &quot;url&quot;: &quot;pubsub&quot;
      }
    }, ... ]
  ...
}
</code></pre>

<p>The <em>name</em> field contains the name of the Data Source, and it has the following form: <code>&lt;dataSourceOperatorName&gt;.&lt;resultPortName&gt;</code>.</p>
<p>The <em>operatorName</em> field is the Data Source operator name.</p>
<p>The <em>portName</em> field is the result port name of the Data Source operator.</p>
<p>The <em>query</em> field describes the query mechanism, including the topic. </p>
<p>The <em>result</em> field describes the result mechanism, including the topic and whether the query ID will be appended to the topic. Setting <code>appendQIDToTopic</code> to true increases the granularity of topics so that callers can receive results only for their queries. If the cost of creating such a large number of topics is high, it can be set to false; callers then will need to filter the results suitably.</p>
<h3 id="message-bus_1">Message Bus</h3>
<p>dtGateway has a WebSocket service that provides the pubsub mechanism required by the Message Bus. The URL is <code>ws://{dtGatewayAddress}/pubsub</code>. You can publish data with a topic by sending a WebSocket message like this:</p>
<pre><code>{
  “type”: “publish”, “topic”: “{topic}”, “data”: {data}
}
</code></pre>

<p>The <em>topic</em> field is the topic name, and the <em>data</em> field is the payload and can be any JSON object.</p>
<p>All client that have subscribed to the topic will receive the data. The format is:</p>
<pre><code>{
  “type”: “data”, “topic”: “{topic}”, “data”: {data}
}
</code></pre>

<p>And to subscribe to the topic, the client must send this message to dtGateway using WebSocket:</p>
<pre><code>{
  “type”: “subscribe”, “topic”: “{topic}”
}
</code></pre>

<p>You can try it with dtGateway using a web browser with the help of a WebSocket client (e.g. “Simple WebSocket Client” extension in Google Chrome).</p>
<p>Note that dtGateway does not keep the history of the messages. </p>
<h3 id="interaction-between-data-source-and-web-browser">Interaction between Data Source and Web Browser</h3>
<p>The web browser, the Query Operator and the Result Operator all connect to dtGateway via the Message Bus. The following describes the step-by-step interaction among them on a high level:</p>
<ol>
<li>The UI widget in the browser subscribes to the result topic</li>
<li>The UI widget sends a schema query to the query topic.</li>
<li>The Data Source Operator gets the schema query and sends the schema result to the result topic, which the UI widget receives.</li>
<li>The UI widget in the browser subscribes to the result topic</li>
<li>The UI widget sends a data query</li>
<li>The Data Source Operator gets the data query and processes it and sends back the data result to the result topic.</li>
<li>The UI widget receives the data result and renders it.</li>
</ol>
<p>Let’s look at the actual messages being exchanged for the Twitter example.</p>
<h4 id="snapshot-schema">Snapshot Schema</h4>
<p>The Snapshot Schema serves a simple snapshot of tabular data, which is typically constantly being updated and is used in the Twitter example. We will describe the Snapshot schema as we look at the messages.</p>
<p>Step 1: Browser sends Schema Response Subscribe</p>
<pre><code class="json">{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;topic&quot;: &quot;TwitterHashtagQueryResultDemo.0.20716154835833223&quot;
}
</code></pre>

<p>In preparation for a Schema Query, the browser first subscribes to the result topic (with the query ID appended) to get the Schema Result back. In this case, the browser generates a random string, “0.20716154835833223” for the query ID, and appends the query ID to the result topic that it is subscribing to. </p>
<p>Step 2: Browser sends Schema Query</p>
<pre><code class="json">{
  &quot;type&quot;: &quot;publish&quot;,
  &quot;topic&quot;: &quot;TwitterHashtagQueryDemo&quot;,
  &quot;data&quot;: {
    &quot;id&quot;: 0.20716154835833223,
    &quot;type&quot;: &quot;schemaQuery&quot;
  }
}
</code></pre>

<p>The browser sends a message with type, <em>schemaQuery</em>. This is the query that asks for the schema type and schema data. </p>
<p>Step 3: Data Source sends Schema Response</p>
<pre><code class="json">{
  &quot;topic&quot;: &quot;TwitterHashtagQueryResultDemo.0.20716154835833223&quot;,
  &quot;data&quot;: {
    &quot;id&quot;: &quot;0.20716154835833223&quot;,
    &quot;type&quot;: &quot;schemaResult&quot;,
    &quot;data&quot;: [
      {
        &quot;values&quot;: [
          {
            &quot;name&quot;: &quot;hashtag&quot;,
            &quot;type&quot;: &quot;string&quot;
          },
          {
            &quot;name&quot;: &quot;count&quot;,
            &quot;type&quot;: &quot;integer&quot;
          }
        ],
        &quot;schemaType&quot;: &quot;snapshot&quot;,
        &quot;schemaVersion&quot;: &quot;1.0&quot;
      }
    ]
  },
  &quot;type&quot;: &quot;data&quot;
}
</code></pre>

<p>The Data Source sends back the <em>schemaResult</em>, which contains the response to <em>schemaQuery</em>, which contains schema type and schema data. In this case, schemaType is snapshot and schemaVersion is 1.0, and the available fields in the data are “hashtag”, which is a string, and “count”, which is an integer.</p>
<p>Step 4: Browser sends Data Result Subscribe</p>
<pre><code class="json">{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;topic&quot;: &quot;TwitterHashtagQueryResultDemo.0.6760250790172551&quot;
}
</code></pre>

<p>Similar to the previous subscribe message, the browser subscribes to the result topic to get the response for the <em>dataQuery</em> that the browser is going to issue.</p>
<p>Step 5: Browser sends Data Query Request</p>
<pre><code class="json">{
  &quot;type&quot;: &quot;publish&quot;,
  &quot;topic&quot;: &quot;TwitterHashtagQueryDemo&quot;,
  &quot;data&quot;: {
    &quot;id&quot;: 0.6760250790172551,
    &quot;type&quot;: &quot;dataQuery&quot;,
    &quot;data&quot;: {
      &quot;fields&quot;: [
        &quot;hashtag&quot;,
        &quot;count&quot;
      ]
    },
    &quot;countdown&quot;: 30,
    &quot;incompleteResultOK&quot;: true
  }
}
</code></pre>

<p>The browser sends the <em>dataQuery</em> message that asks for actual data.</p>
<p>The <em>countdown</em> field expects an optional integer value. It tells the Data Source that the Data Source should return results once for subsequent {countdown} application windows. In this example, the value is 30. That means the Data Source should execute this query 30 times, once for each application window for the next 30 application windows.</p>
<p>The <em>incompleteResultOK</em> field is an optional boolean value default to be false. If the value is true, the Data Source should return results as soon as they are available even if they are partial results. This is useful when {countdown} is greater than 1 and the Data Source could take a long time to return the complete result set and if it is desirable for the caller to receive the results as soon as possible. If this value is false, Data Source should return the complete result set to the caller</p>
<p>Within the <em>data</em> field, the <em>fields</em> field tells the Data Source what fields to return in the result.</p>
<p>Step 6: Data Source sends Data Response</p>
<pre><code class="json">{
  &quot;topic&quot;: &quot;TwitterHashtagQueryResultDemo.0.6760250790172551&quot;,
  &quot;data&quot;: {
    &quot;id&quot;: &quot;0.6760250790172551&quot;,
    &quot;type&quot;: &quot;dataResult&quot;,
    &quot;data&quot;: [
      {
        &quot;count&quot;: &quot;1398&quot;,
        &quot;hashtag&quot;: &quot;사설토토추천사이트&quot;
      },
      {
        &quot;count&quot;: &quot;1415&quot;,
        &quot;hashtag&quot;: &quot;TopDance&quot;
      },
      {
        &quot;count&quot;: &quot;1498&quot;,
        &quot;hashtag&quot;: &quot;isola&quot;
      },
      {
        &quot;count&quot;: &quot;1521&quot;,
        &quot;hashtag&quot;: &quot;RTした人全員フォローする&quot;
      },
      {
        &quot;count&quot;: &quot;1728&quot;,
        &quot;hashtag&quot;: &quot;4月19日は西木野真姫の誕生日&quot;
      },
      {
        &quot;count&quot;: &quot;1787&quot;,
        &quot;hashtag&quot;: &quot;네임드사다리&quot;
      },
      {
        &quot;count&quot;: &quot;2079&quot;,
        &quot;hashtag&quot;: &quot;ALDUBActing101&quot;
      },
      {
        &quot;count&quot;: &quot;2280&quot;,
        &quot;hashtag&quot;: &quot;地震&quot;
      },
      {
        &quot;count&quot;: &quot;2712&quot;,
        &quot;hashtag&quot;: &quot;西木野真姫生誕祭2016&quot;
      },
      {
        &quot;count&quot;: &quot;2714&quot;,
        &quot;hashtag&quot;: &quot;شعيب_يسيء_للسعوديه&quot;
      }
    ],
    &quot;countdown&quot;: &quot;29&quot;
  },
  &quot;type&quot;: &quot;data&quot;
}
</code></pre>

<p>The Data Source sends the <em>dataResult</em> message in response to the <em>dataQuery</em>. In this case, it contains a list of (hashtag, count) sets in the <em>data</em> field.</p>
<p>If the <em>countdown</em> field of the <em>dataQuery</em> is non-zero, there will be multiple such messages that correspond to one <em>dataQuery</em> message.  The <em>countdown</em> field in the <em>dataResult</em> message decrements every time it sends a result.  When it counts down to zero, the query has expired and the client must send another <em>dataQuery</em> message to receive further updates.</p>
<p>In this case, because the countdown value is 30 in the <em>dataQuery</em>, the Data Source will keep sending the latest data set for the next 29 application windows following this initial response.</p>
<p>For more information about the operators behind this Snapshot Schema, please refer to <a href="http://docs.datatorrent.com/operators/snapshot_server/">this document</a>.</p>
<h4 id="dimensions-schema">Dimensions Schema</h4>
<p>The Dimensions Schema is an extension of the Snapshot Schema with the notion of time and key dimensions. It is supported in DataTorrent RTS. </p>
<p>We will look at the message exchange in the Sales example.</p>
<p>Step 1: Browser sends Schema Response Subscribe</p>
<pre><code class="json">{&quot;type&quot;:&quot;subscribe&quot;,&quot;topic&quot;:&quot;SalesQueryResultDemo.0.676153457723558&quot;}
</code></pre>

<p>This is similar to the Snapshot example we saw earlier.</p>
<p>Step 2: Browser sends Schema Query</p>
<pre><code class="json">{
   &quot;type&quot;:&quot;publish&quot;,
   &quot;topic&quot;:&quot;SalesQueryDemo&quot;,
   &quot;data&quot;:{
      &quot;id&quot;: 0.22710832906886935,
      &quot;type&quot;:&quot;schemaQuery&quot;
   }
}
</code></pre>

<p>Again, this is similar to the Snapshot example we saw earlier.</p>
<p>Step 3: Data Source sends Schema Response.</p>
<pre><code class="json">{
   &quot;topic&quot;:&quot;SalesQueryResultDemo.0.22710832906886935&quot;,
   &quot;data&quot;:{
      &quot;id&quot;:&quot;0.22710832906886935&quot;,
      &quot;type&quot;:&quot;schemaResult&quot;,
      &quot;data&quot;:[
         {
            &quot;schemaType&quot;:&quot;dimensions&quot;,
            &quot;schemaVersion&quot;:&quot;1.0&quot;,
            &quot;time&quot;:{
               &quot;buckets&quot;:[&quot;1m&quot;,&quot;1h&quot;,&quot;1d&quot;,&quot;5m&quot;],
               &quot;slidingAggregateSupported&quot;:true
            },
            &quot;keys&quot;:[
               {
                  &quot;name&quot;:&quot;channel&quot;,
                  &quot;type&quot;:&quot;string&quot;,
                  &quot;enumValues&quot;:[&quot;Mobile&quot;, &quot;Online&quot;, &quot;Store&quot;]
               },
               {
                  &quot;name&quot;:&quot;region&quot;,
                  &quot;type&quot;:&quot;string&quot;,
                  &quot;enumValues&quot;:[&quot;Atlanta&quot;, &quot;Boston&quot;,&quot;Chicago&quot;,&quot;Cleveland&quot;,&quot;Dallas&quot;,
                     &quot;Minneapolis&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Francisco&quot;,&quot;St. Louis&quot;]
               },
               {
                  &quot;name&quot;:&quot;product&quot;,
                  &quot;type&quot;:&quot;string&quot;,
                  &quot;enumValues&quot;:[&quot;Laptops&quot;,&quot;Printers&quot;,&quot;Routers&quot;,&quot;Smart Phones&quot;,&quot;Tablets&quot;]
               }
            ],
            &quot;values&quot;:[
               {
                  &quot;name&quot;:&quot;tax:SUM&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;sales:SUM&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;discount:SUM&quot;,
                  &quot;type&quot;:&quot;double&quot;
               }
            ],
            &quot;dimensions&quot;:[
               {
                  &quot;combination&quot;:[

                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;channel&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;region&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;product&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;region&quot;,
                     &quot;channel&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;product&quot;,
                     &quot;channel&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;product&quot;,
                     &quot;region&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;product&quot;,
                     &quot;region&quot;,
                     &quot;channel&quot;
                  ]
               }
            ]
         }
      ]
   },
   &quot;type&quot;:&quot;data&quot;
}
</code></pre>

<p>Compared to the Snapshot Schema, this is considerably more complex. The response to the query describes the keys and aggregates that are provided by the data source. The basic components of the schema are the following:</p>
<p><strong>timebuckets</strong>: These are the time buckets over which aggregations are computed. For example, 1d (one day), 1h (one hour), 1m (one minute), 1s (one second).</p>
<p><strong>keys</strong>: These are the search parameters you need to provide when you do a query. The keys have an enumValues. This is an optional section which contains all possible values of a key. This section may be updated by the back end if new key values are encountered.</p>
<p><strong>values</strong>: These are the results which are returned by a query. Notice that the values are of the form (name):(aggregation). The first portion of the value name describes what is being aggregated. The second portion of the value name describes the aggregation being used.</p>
<p><strong>combinations</strong>: This describes the valid combinations of keys that can be specified when doing a query.</p>
<p>Step 4: Browser sends Data Result Subscribe</p>
<pre><code class="json">{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;topic&quot;: &quot;SalesQueryResultDemo.0.3180227109696716&quot;
}
</code></pre>

<p>Step 5: Browser sends Data Query Request</p>
<p>Now that the valid combinations, keys, values, and timebuckets are known, we can issue a query using them. </p>
<pre><code class="json">{
   &quot;type&quot;:&quot;publish&quot;,
   &quot;topic&quot;:&quot;SalesQueryDemo&quot;,
   &quot;data&quot;:{
      &quot;id&quot;: &quot;0.3180227109696716&quot;,
      &quot;type&quot;:&quot;dataQuery&quot;,
      &quot;data&quot;:{
         &quot;time&quot;:{
            &quot;latestNumBuckets&quot;:10,
            &quot;bucket&quot;:&quot;1m&quot;
         },
         &quot;incompleteResultOK&quot;:true,
         &quot;keys&quot;:{

         },
         &quot;fields&quot;:[
            &quot;time&quot;,
            &quot;channel&quot;,
            &quot;region&quot;,
            &quot;product&quot;,
            &quot;tax:SUM&quot;,
            &quot;sales:SUM&quot;,
            &quot;discount:SUM&quot;
         ]
      },
      &quot;countdown&quot;:29,
      &quot;incompleteResultOK&quot;:true
   }
}
</code></pre>

<p><strong>time</strong>: This specifies which time buckets to query. In this case the most recent 10 one minute time buckets are queried. The example above illustrates how to query the last N timebuckets, but it is also possible to do history queries by specifying a time section like the following:</p>
<pre><code class="json">        &quot;time&quot;:{
         &quot;bucket&quot;:&quot;1m&quot;,
         &quot;from&quot;:1460765563547,
         &quot;to&quot;:1460767363547
       }
</code></pre>

<p>This time section specifies a historical query starting at the “from” unix timestamp (inclusive) up until the “to” timestamp (inclusive).</p>
<p><strong>keys</strong>: These are the search parameters. This section can be empty to query global aggregations. If there are specific key combinations you want to search for you can do this:</p>
<pre><code>“key”: {
  “channel”: “Mobile”
  “region”: “Atlanta”
}
</code></pre>

<p>It is possible to specify a key with a list like the following:</p>
<pre><code>“key”: {
  “channel”: “Mobile”
  “region”: [ “Atlanta”, “Dallas” ]
}
</code></pre>

<p>This will query all the data with a <em>channel</em> value of “Mobile” and a <em>region</em> value of “Atlanta” OR “Dallas”. It is also possible to specify a key with an empty array like the following:</p>
<pre><code>“key”: {
  “channel”: “Mobile”
  “region”: []
}
</code></pre>

<p>This will query all the data with a <em>channel</em> value of “Mobile” and ANY value of <em>region</em>.
Note that this is different from not specifying the <em>region</em> value at all, in which case, the aggregated value of all regions will be returned. This is similar to the difference between the SQL queries of <code>SELECT SUM(sales) WHERE channel=’Mobile’</code> (for the case of not specifying <em>region</em>) and <code>SELECT SUM(sales), region WHERE channel=’Mobile’ GROUP BY region</code> (for the case of <em>region</em> being an empty array).</p>
<p><strong>fields</strong>: This specifies what data to include in the query result. If the field <em>time</em> is included, then a timestamp is included for each data point. Similarly the keys can also be specified as fields with the results. Lastly aggregated values can also be specified as fields to be returned in results.</p>
<p>Step 6: Data Source sends Data Response.</p>
<p>After a query is issued, results are periodically returned:</p>
<pre><code class="json">{
   &quot;topic&quot;:&quot;SalesQueryResultDemo.0.3180227109696716&quot;,
   &quot;data&quot;: {
      &quot;id&quot;:&quot;0.3180227109696716&quot;,
      &quot;type&quot;:&quot;dataResult&quot;,
      &quot;data&quot;:[
         {
            &quot;time&quot;:&quot;1460771580000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;78363.47&quot;,
            &quot;sales:SUM&quot;:&quot;922988.9199999997&quot;,
            &quot;discount:SUM&quot;:&quot;69135.71999999999&quot;
         },
         {
            &quot;time&quot;:&quot;1460771640000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;142011.85&quot;,
            &quot;sales:SUM&quot;:&quot;1672677.0099999998&quot;,
            &quot;discount:SUM&quot;:&quot;125287.46999999999&quot;
         },
         {
            &quot;time&quot;:&quot;1460771700000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;139069.53999999998&quot;,
            &quot;sales:SUM&quot;:&quot;1638011.5399999998&quot;,
            &quot;discount:SUM&quot;:&quot;122692.48999999999&quot;
         },
         {
            &quot;time&quot;:&quot;1460771760000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;80699.90000000001&quot;,
            &quot;sales:SUM&quot;:&quot;950502.3500000003&quot;,
            &quot;discount:SUM&quot;:&quot;71196.95000000001&quot;
         },
         {
            &quot;time&quot;:&quot;1460771820000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;35914.69&quot;,
            &quot;sales:SUM&quot;:&quot;423017.9000000001&quot;,
            &quot;discount:SUM&quot;:&quot;69339.05000000002&quot;
         },
         {
            &quot;time&quot;:&quot;1460771880000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;106977.84999999998&quot;,
            &quot;sales:SUM&quot;:&quot;1260017.5600000003&quot;,
            &quot;discount:SUM&quot;:&quot;629939.14&quot;
         },
         {
            &quot;time&quot;:&quot;1460771940000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;253243.50000000003&quot;,
            &quot;sales:SUM&quot;:&quot;2982796.9300000006&quot;,
            &quot;discount:SUM&quot;:&quot;1491234.3599999999&quot;
         },
         {
            &quot;time&quot;:&quot;1460772000000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;161384.77999999997&quot;,
            &quot;sales:SUM&quot;:&quot;1900857.2300000002&quot;,
            &quot;discount:SUM&quot;:&quot;950325.01&quot;
         },
         {
            &quot;time&quot;:&quot;1460772060000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;125283.99000000002&quot;,
            &quot;sales:SUM&quot;:&quot;1475625.3600000003&quot;,
            &quot;discount:SUM&quot;:&quot;737730.77&quot;
         },
         {
            &quot;time&quot;:&quot;1460772120000&quot;,
            &quot;region&quot;:&quot;Boston&quot;,
            &quot;product&quot;:&quot;ALL&quot;,
            &quot;channel&quot;:&quot;Mobile&quot;,
            &quot;tax:SUM&quot;:&quot;58684.59&quot;,
            &quot;sales:SUM&quot;:&quot;691200.9299999999&quot;,
            &quot;discount:SUM&quot;:&quot;345562.2700000001&quot;
         }
      ],
      &quot;countdown&quot;:&quot;297&quot;
   },
   &quot;type&quot;:&quot;data&quot;
}
</code></pre>

<p>As you can see each result represents a time bucket with the corresponding values for the fields. If the ANY value (with an empty list) query is specified for a key you will see multiple results for the same time bucket, but each result will have different values for the keys.</p>
<p>Detailed documentation of the dimensions operators can be found here: <a href="http://docs.datatorrent.com/operators/dimensions_computation/">http://docs.datatorrent.com/operators/dimensions_computation/</a></p>
<h3 id="advanced-topics">Advanced Topics</h3>
<h4 id="schema-keys">Schema Keys</h4>
<p>Although in most cases, a Data Source has one fixed schema, it is sometimes necessary for a Data Source to support multiple schemas. This is useful if the schemas are dynamically created depending on the incoming data to the Data Source Operator.</p>
<p>Schema Key is the feature we added to the App Data Framework for this purpose. If the Data Source has multiple schemas, the <em>schemaResult</em> will contain a list of schemas with the corresponding schema keys in the <em>context</em> field:</p>
<pre><code>{
  “id”: “{client_generated_id}”,
  “type”: “schemaResult”,
  “data”: [ 
    {
      “context”: {
        “schemaKeys”: {
          “{key1}”: “{value1}”,
          “{key2}”: “{value2}”, ...
         }
      },
      {rest of the schema}
    }, ...
  ]
}
</code></pre>

<p>And if the <em>schemaResult</em> returns multiple schemas, all <em>dataQuery</em> messages must include the schema keys:</p>
<pre><code>{
   “id”: “{client_generated_id}”,
   “type”: “dataQuery”, 
   “data”: {
     “context”: {
       “schemaKeys” { //optional
    “{keyName1}”: “{keyValue1}”,
    “{keyName2}”: “{keyValue2}” 
       }
     }
     {rest of the query}
   }
   “countdown”: “{countdown}”,
   “incompleteResultOK”: true/false
}
</code></pre>

<p>This feature is supported by the DimensionsStore operator and is being used by the App Data Tracker.</p>
<h4 id="dimensions-schema-additional-values-for-combinations">Dimensions Schema: Additional Values for Combinations</h4>
<p>For the Dimensions Schema supported by the DimensionsStore operator, there can be more complex schema specifications which have results for values only for certain combinations. This is the schema for yet another example about aggregation of advertisement data in the DataTorrent RTS example repository.</p>
<pre><code class="json">{
   &quot;topic&quot;:&quot;AdsQueryGenericResultDemo.0.08170037856325507&quot;,
   &quot;data&quot;:{
      &quot;id&quot;:&quot;0.08170037856325507&quot;,
      &quot;type&quot;:&quot;schemaResult&quot;,
      &quot;data&quot;:[
         {
            &quot;schemaType&quot;:&quot;dimensions&quot;,
            &quot;schemaVersion&quot;:&quot;1.0&quot;,
            &quot;time&quot;:{
               &quot;buckets&quot;:[&quot;1m&quot;,&quot;1h&quot;,&quot;1d&quot;],
               &quot;slidingAggregateSupported&quot;:true,
               &quot;from&quot;:&quot;1459987200000&quot;,
               &quot;to&quot;:&quot;1460768100000&quot;
            },
            &quot;keys&quot;:[
               {
                  &quot;name&quot;:&quot;publisher&quot;,
                  &quot;type&quot;:&quot;string&quot;,
                  &quot;enumValues&quot;:[&quot;twitter&quot;,&quot;facebook&quot;,&quot;yahoo&quot;,&quot;google&quot;,&quot;bing&quot;,&quot;amazon&quot;
                  ]
               },
               {
                  &quot;name&quot;:&quot;advertiser&quot;,
                  &quot;type&quot;:&quot;string&quot;,
                  &quot;enumValues&quot;:[&quot;starbucks&quot;,&quot;safeway&quot;,&quot;mcdonalds&quot;,&quot;macys&quot;,&quot;taco bell&quot;,
                     &quot;walmart&quot;,&quot;kohls&quot;,&quot;san diego zoo&quot;,&quot;pandas&quot;,&quot;jack in the box&quot;,
                     &quot;tomatina&quot;,&quot;ron swanson&quot;
                  ]
               },
               {
                  &quot;name&quot;:&quot;location&quot;,
                  &quot;type&quot;:&quot;string&quot;,
                  &quot;enumValues&quot;:[
                     &quot;N&quot;,&quot;LREC&quot;,&quot;SKY&quot;,&quot;AL&quot;,&quot;AK&quot;,&quot;AZ&quot;,&quot;AR&quot;,&quot;CA&quot;,&quot;CO&quot;,&quot;CT&quot;,&quot;DE&quot;,&quot;FL&quot;,
                     &quot;GA&quot;,&quot;HI&quot;,&quot;ID&quot;
                  ]
               }
            ],
            &quot;values&quot;:[
               {
                  &quot;name&quot;:&quot;impressions:COUNT&quot;,
                  &quot;type&quot;:&quot;long&quot;
               },
               {
                  &quot;name&quot;:&quot;impressions:SUM&quot;,
                  &quot;type&quot;:&quot;long&quot;
               },
               {
                  &quot;name&quot;:&quot;impressions:AVG&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;clicks:COUNT&quot;,
                  &quot;type&quot;:&quot;long&quot;
               },
               {
                  &quot;name&quot;:&quot;clicks:SUM&quot;,
                  &quot;type&quot;:&quot;long&quot;
               },
               {
                  &quot;name&quot;:&quot;clicks:AVG&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;cost:COUNT&quot;,
                  &quot;type&quot;:&quot;long&quot;
               },
               {
                  &quot;name&quot;:&quot;cost:SUM&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;cost:AVG&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;revenue:COUNT&quot;,
                  &quot;type&quot;:&quot;long&quot;
               },
               {
                  &quot;name&quot;:&quot;revenue:SUM&quot;,
                  &quot;type&quot;:&quot;double&quot;
               },
               {
                  &quot;name&quot;:&quot;revenue:AVG&quot;,
                  &quot;type&quot;:&quot;double&quot;
               }
            ],
            &quot;dimensions&quot;:[
               {
                  &quot;combination&quot;:[

                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;location&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;advertiser&quot;
                  ],
                  &quot;additionalValues&quot;:[
                     {
                        &quot;name&quot;:&quot;impressions:MAX&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;impressions:MIN&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;clicks:MAX&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;clicks:MIN&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;cost:MAX&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     },
                     {
                        &quot;name&quot;:&quot;cost:MIN&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     },
                     {
                        &quot;name&quot;:&quot;revenue:MAX&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     },
                     {
                        &quot;name&quot;:&quot;revenue:MIN&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     }
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;publisher&quot;
                  ],
                  &quot;additionalValues&quot;:[
                     {
                        &quot;name&quot;:&quot;impressions:MAX&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;impressions:MIN&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;clicks:MAX&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;clicks:MIN&quot;,
                        &quot;type&quot;:&quot;long&quot;
                     },
                     {
                        &quot;name&quot;:&quot;cost:MAX&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     },
                     {
                        &quot;name&quot;:&quot;cost:MIN&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     },
                     {
                        &quot;name&quot;:&quot;revenue:MAX&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     },
                     {
                        &quot;name&quot;:&quot;revenue:MIN&quot;,
                        &quot;type&quot;:&quot;double&quot;
                     }
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;location&quot;,
                     &quot;advertiser&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;location&quot;,
                     &quot;publisher&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;advertiser&quot;,
                     &quot;publisher&quot;
                  ]
               },
               {
                  &quot;combination&quot;:[
                     &quot;location&quot;,
                     &quot;advertiser&quot;,
                     &quot;publisher&quot;
                  ]
               }
            ]
         }
      ]
   },
   &quot;type&quot;:&quot;data&quot;
}
</code></pre>

<p>Here you can see that a combination can also have <code>additionalValues</code> specified. Additional values are values which are only available for a specific combination of keys.</p>
<p>The code for the ads example is available <a href="https://github.com/DataTorrent/examples/tree/master/dt-demo/dimensions/src/main/java/com/datatorrent/demos/dimensions/ads/generic">here</a>.</p>
<h3 id="ui-widgets_1">UI Widgets</h3>
<p>Coming soon</p>
<h3 id="app-data-tracker">App Data Tracker</h3>
<p>App Data Tracker is discussed <a href="http://docs.datatorrent.com/app_data_tracker/">here</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dtgateway_api/" class="btn btn-neutral float-right" title="REST API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../operators/snapshot_server/" class="btn btn-neutral" title="Snapshot Server"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../operators/snapshot_server/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dtgateway_api/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
