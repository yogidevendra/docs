<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../favicon.ico">
  
  <title>Security - DataTorrent Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Security";
    var mkdocs_page_input_path = "dtgateway_security.md";
    var mkdocs_page_url = "/dtgateway_security/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44586211-2', 'docs.datatorrent.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> DataTorrent Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">DataTorrent RTS</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Demos</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../demos/">Running Apps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sandbox/">Sandbox</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cloud Integration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../aws_emr_manual/">AWS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../create/">Creating Applications</a>
                </li>
                <li class="">
                    
    <a class="" href="../beginner/">Beginner's Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../demo_videos/">Videos</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <span class="caption-text">Top N Words</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords/">Introduction</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c1/">Development Environment</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c2/">Building in Java</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c3/">Building with dtAssemble</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c4/">Monitoring with dtManage</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c5/">Visualizing with dtDashboard</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c7/">Advanced Features</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/topnwords-c6/">Appendix</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Sales Dimensions</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions/">Building in Java</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions-c2/">Building with dtAssemble</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions-c3/">Visualizing with dtDashboard</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../tutorials/salesdimensions-c4/">Monitoring with dtManage</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../apex_development_setup/">Apex Development Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../configure_IDE/">Generate New Project in IDE</a>
                </li>
                <li class="">
                    
    <a class="" href="../application_development/">Applications</a>
                </li>
                <li class="">
                    
    <a class="" href="../application_packages/">Application Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration_packages/">Configuration Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../operator_development/">Operators</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Library Operators</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../library_operators/">List of Operators</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/block_reader/">Block Reader</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/deduper/">Deduper</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/dimensions_computation/">Dimension Computation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/file_output/">File Output</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/file_splitter/">File Splitter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/hdht/">HDHT</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/kafkaInputOperator/">Kafka Input</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../operators/snapshot_server/">Snapshot Server</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../app_data_framework/">App Data Framework</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_api/">REST API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">App Templates</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">0.10.0</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/common/import-launch/">Import and Launch App-template</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/common/customize/">Customizing an app-template</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/database-to-database-sync/">Database-to-database-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/hdfs-line-copy/">HDFS-line-copy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/hdfs-part-file-copy/">HDFS-part-file-copy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/hdfs-to-hdfs-filter-transform/">HDFS-to-HDFS-filter-transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-cassandra-filter-transform/">Kafka-to-Cassandra-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-database-sync/">Kafka-to-Database-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-hdfs-filter-transform/">Kafka-to-HDFS-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kafka-to-kafka-filter-transform/">Kafka-to-Kafka-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kinesis-to-redshift/">Kinesis-to-Redshift</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/kinesis-to-s3/">Kinesis-to-S3</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/s3-to-hdfs-sync/">S3-to-HDFS-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../app-templates/0.10.0/s3-to-redshift/">S3-to-HDFS-Filter-Transform</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/database-to-hdfs/">Database dump to HDFS App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/database-to-database-sync/">Database to Database Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-sync/">HDFS Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-line-copy/">HDFS to HDFS Line Copy App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/hdfs-to-kafka-sync/">HDFS to Kafka Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kafka-to-database-sync/">Kafka to Database Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kafka-to-hdfs-filter/">Kafka to HDFS Filter App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kafka-to-hdfs-sync/">Kafka to HDFS Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/kinesis-to-s3/">Kinesis to S3 App</a>
                </li>
                <li class="">
                    
    <a class="" href="../app-templates/s3-to-hdfs-sync/">S3 to HDFS Sync App</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../app_data_tracker/">App Data Tracker</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtingest/">dtIngest</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Platform</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../rts/">RTS</a>
                </li>
                <li class="">
                    
    <a class="" href="../application_configurations/">Application Configurations</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtmanage/">dtManage</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtassemble/">dtAssemble</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtdashboard/">dtDashboard</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway/">dtGateway</a>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_systemalerts/">Alerts</a>
                </li>
                <li class="">
                    
    <a class="" href="../apex/">Apache Apex</a>
                </li>
                <li class="">
                    
    <a class="" href="../apex_malhar/">Apache Apex-Malhar</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deployment and Operations</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/">Configuration</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Security</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#datatorrent-gateway-security">DataTorrent Gateway Security</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#kerberos-secure-mode">Kerberos Secure Mode</a></li>
        
            <li><a class="toctree-l4" href="#authentication">Authentication</a></li>
        
            <li><a class="toctree-l4" href="#hadoop-user-mapping">Hadoop user mapping</a></li>
        
            <li><a class="toctree-l4" href="#authorization">Authorization</a></li>
        
            <li><a class="toctree-l4" href="#viewing-and-managing-auth-in-the-console">Viewing and Managing Auth in the Console</a></li>
        
            <li><a class="toctree-l4" href="#authorization-using-external-roles">Authorization using external roles</a></li>
        
            <li><a class="toctree-l4" href="#administering-using-command-line">Administering Using Command Line</a></li>
        
            <li><a class="toctree-l4" href="#setting-up-ssl-keystore-in-gateway">Setting up SSL Keystore in Gateway</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../dtgateway_systemalerts/">System Alerts</a>
                </li>
                <li class="">
                    
    <a class="" href="../apexcli/">Apex CLI</a>
                </li>
                <li class="">
                    
    <a class="" href="../troubleshooting/">Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../release_notes/">Release Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../glossary/">Glossary</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../additional_docs/">Resources</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">DataTorrent Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Deployment and Operations &raquo;</li>
        
      
    
    <li>Security</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="datatorrent-gateway-security">DataTorrent Gateway Security</h1>
<p>DataTorrent Gateway is a service that provides the backend functionality
for the DataTorrent UI Console and processes the web service requests from it. The service provides real-time information about running applications, allows changes to applications, launches new applications among various other operations. Refer to <a href="../dtgateway/">dtGateway</a> for details on the Gateway service and <a href="../dtmanage/">dtManage</a> for the UI Console.</p>
<p>Broadly security in Gateway can be classified into two categories, frontend security and backend security. Frontend security deals with access to Gateway service which mainly involves securing the web service calls. This includes aspects such as user authentication and authorization. The backend security deals with security aspects when Gateway is communicating with a secure Hadoop infrastructure.</p>
<p>After installation of DataTorrent RTS both these aspects can be configured manually as described in the following sections although work is being done to enable this configuration in the UI Console during installation itself and post installation.</p>
<h2 id="kerberos-secure-mode">Kerberos Secure Mode</h2>
<p>Kerberos is the de-facto authentication mechanism supported in Hadoop. When secure mode is enabled in Hadoop, requests from clients to Hadoop are authenticated using Kerberos. In this mode Gateway service needs Kerberos credentials to communicate with Hadoop. The credentials should match the user that the DT Gateway service is running under.</p>
<p>In a multi-user installation DT Gateway is typically running as
user <code>dtadmin</code> and the Kerberos credentials specified should be for this
user. They are specified in the <code>dt-site.xml</code> configuration file located in the config folder under the installation which is typically <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for local install). For a single user installation where gateway is running as the user, the Kerberos credentials will be the user’s credentials.</p>
<p>The snippet below shows how the credentials can be specified in the
configuration file.</p>
<pre><code class="xml">&lt;property&gt;
        &lt;name&gt;dt.gateway.authentication.principal&lt;/name&gt;
        &lt;value&gt;kerberos-principal-of-gateway-user&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
        &lt;name&gt;dt.gateway.authentication.keytab&lt;/name&gt;
        &lt;value&gt;absolute-path-to-keytab-file&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<h3 id="long-running-applications">Long running applications</h3>
<p>In secure mode, long running applications have additional requirements. Refer to the Token Refresh section in the Apache Apex security <a href="https://apex.apache.org/docs/apex/security/">document</a>.</p>
<h2 id="authentication">Authentication</h2>
<p>DataTorrent Gateway has support for authentication and when it is configured users have to authenticate before they can access the UI Console. Various authentication mechanisms are supported and this gives enterprises the flexibility to extend their existing authentication mechanism already in use within the enterprise to Gateway. It also supports roles, mapping of groups or roles from the external authentication mechanism to roles and supports role based authorization.</p>
<p>The different authentication mechanisms supported by Gateway are</p>
<ul>
<li><a href="#password-authentication">Password Authentication</a></li>
<li><a href="#ldap-authentication">LDAP Authentication</a></li>
<li><a href="#kerberos-authentication">Kerberos Authentication</a></li>
<li><a href="#jaas-authentication">JAAS Authentication</a> for Active Directory, PAM, etc</li>
</ul>
<p>JAAS is a extensible authentication framework that supports different types of authentication mechanisms by plugging in an appropriate module.</p>
<h3 id="password-authentication">Password Authentication</h3>
<p>Password security is simple to set up and is ideal for a small to medium set of users. It comes with role-based access control, so users can be assigned roles, and roles can be assigned granular permissions (see <a href="../dtmanage/#user-management">User Management</a>). This is the only authentication mechanism available that does not depend on any external systems. The users will be managed locally by the Gateway. When enabled, all users will be presented with the login prompt before being able to use the DT Console.</p>
<p>To set up password security, on the <a href="../dtmanage/#security-configuration">Security Configuration</a> page select <strong>Password</strong> from the <em>Authentication Type</em> dropdown, and save. Allow the Gateway to restart.</p>
<p><img alt="Security Configuration - Password" src="../images/dtmanage/security-password.png" /></p>
<p>When the Gateway has restarted, you should be prompted for username and password. Log in as the default admin user <strong>dtadmin</strong> with password <strong>dtadmin</strong>.</p>
<p><img alt="" src="../images/GatewaySecurity/image02.png" /></p>
<p>Once authenticated, active username and an option to log out is presented in the top right corner of the DT Console screen.</p>
<p><img alt="" src="../images/GatewaySecurity/image00.png" /></p>
<p>Additional users and roles can be created and managed on the <a href="#user-management">User Management</a> page.</p>
<p><em>Note</em>: Don't forget to change your <strong>dtadmin</strong> user's password!</p>
<h4 id="password-authentication-via-dt-sitexml">Password Authentication via dt-site.xml</h4>
<p>Password authentication can alternatively be configured outside the Console by performing following two steps:</p>
<ol>
<li>
<p>Add a property to <code>dt-site.xml</code> configuration file, typically located
    under <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for local install).</p>
<pre><code>&lt;configuration&gt;
...
    &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
    &lt;value&gt;password&lt;/value&gt;
    &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>Restart the Gateway. If running Gateway in local mode use <code>dtgateway restart</code> instead.</p>
<pre><code>sudo service dtgateway restart
</code></pre>
</li>
</ol>
<h3 id="ldap-authentication">LDAP Authentication</h3>
<p>LDAP is a directory based authentication mechanism used in many enterprises. If your organization uses LDAP for authentication, the LDAP security option is ideal for giving your existing users access to RTS, with the role-based access control and group mapping features.</p>
<p>There are four variations for configuring LDAP authentication:</p>
<ul>
<li><strong>Identity</strong><ul>
<li>Provide the parent DN of your users and <em>specify the RDN attribute of users</em>.</li>
<li>Users will authenticate using their RDN attribute value as their username.</li>
</ul>
</li>
<li><strong>Anonymous &amp; User Search Filter</strong><ul>
<li>Provide the parent DN of your users and <em>specify a search filter to identify users</em>.</li>
<li>Users will authenticate using an appropriate username that matches the parameters defined in the search filter.</li>
</ul>
</li>
<li><strong>Identity and Anonymous Search</strong><ul>
<li>Provide the parent DN of your users, <em>specify the RDN attribute of users, and a search filter</em>.</li>
<li>Users will authenticate using their RDN attribute value as their username, as well as the parameters defined in the search filter.</li>
</ul>
</li>
<li><strong>Non-Anonymous Search with Group Support</strong><ul>
<li>Provide basic DN info for users, DN and password of a user able to perform a non-anonymous search, and optional group support info.</li>
<li>With <em>group support disabled</em>, users need to be added in User Management before logging in. Users authenticate with their RDN attribute value as their username.</li>
<li>With <em>group support enabled</em>, users do not have to be added in User Management before logging in. Users authenticate with their RDN attribute value as their username. They will be assigned roles mapped to their LDAP group. For example, user Peter is part of GroupA (admin) and GroupB (developer, operator); Peter will be assigned roles admin, developer, and operator upon login.</li>
</ul>
</li>
</ul>
<p>When group support is not configured, users must be assigned a role before they are able to log in. This means users can be restricted from logging in (blacklisted) by removing all of their roles.</p>
<p><em>Note</em>: If migrating from <em>Password</em> mode, the existing users will be carried over as "local users" and can still login as if in <em>Password</em> mode. It is recommended to keep only the <strong>dtadmin</strong> user and delete the rest. This is because local users cannot be added or deleted once <em>LDAP</em> mode is activated.</p>
<p><img alt="Security Configuration - LDAP" src="../images/dtmanage/security-LDAP.png" /></p>
<p>After setting up LDAP in the Security Configuration page, the <strong>LDAP Users</strong> section will appear in the User Management page. If you have group support enabled, the <strong>LDAP Groups</strong> section will also appear. Existing users (carried over from <em>Password</em> mode), will be placed in the <strong>Local Users</strong> sections. Local users cannot be added or deleted in LDAP mode, but their roles and passwords can be modified.</p>
<p><img alt="" src="../images/dtmanage/user-management-LDAP.png" /></p>
<p>To configure LDAP via dt-site.xml, check out the <a href="#ldap">JAAS Authentication - LDAP</a> section below.</p>
<h3 id="kerberos-authentication">Kerberos Authentication</h3>
<p>Kerberos authentication can optionally be enabled for Hadoop web access.
When configured, all web browser access to Hadoop management consoles are Kerberos authenticated. Web services are also Kerberos authenticated. This authentication is performed using a protocol called SPNEGO which is Kerberos over HTTP.
Please refer to the administration guide of your Hadoop distribution on
how to enable this. The web browsers must also support SPNEGO, most
modern browsers do and should be configured to use SPNEGO for the
specific URLs being accessed. Please refer to the documentation of the
individual browsers on how to configure this. Gateway handles the SPNEGO
authentication needed when communicating with the Hadoop web-services if
Kerberos authentication is enabled for Hadoop web access.</p>
<p>Kerberos authentication can be enabled for UI Console as well. When it
is enabled access to the Gateway web-services is Kerberos authenticated.
The browser should be configured for SPNEGO authentication when
accessing the Console. A user typically obtains a master ticket first by logging in to kerberos system in a terminal emulator using kinit. Then, user launches a browser to access the Console URL. The browser
will use the master ticket obtained by kinit earlier to obtain the
necessary security tokens to authenticate with the Gateway.</p>
<p>When this authentication is enabled the first authenticated user that
accesses the system is assigned the admin role as there are no other
users in the system at this point. Any subsequent authenticated user
that access the system starts with no roles. The admin user can then
assign roles to these users. This behavior can be changed by configuring
an external role mapping. Please refer to the <a href="#ExternalRoleMapping">External Role Mapping</a> in the <a href="#authorization-using-external-roles">Authorization using external roles</a> section below for that.</p>
<p>Additional configuration is needed to enable Kerberos authentication for
the Console. A separate set of kerberos credentials are needed. These
can be same as the Hadoop web-service Kerberos credentials which are
typically identified with the principal HTTP/HOST@DOMAIN. A few other
configuration properties are also needed. These can be specified in the
same “dt-site.xml” configuration file as the DT Gateway authentication
configuration described in the Operation and Installation Guide. This
authentication can be set up using the following steps.</p>
<ol>
<li>
<p>Add the following properties to <code>dt-site.xml</code> configuration file, typically located under <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for local install)</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
    &lt;value&gt;kerberos&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.kerberos.principal&lt;/name&gt;
    &lt;value&gt;{kerberos-principal-of-web-service}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.kerberos.keytab&lt;/name&gt;
    &lt;value&gt;{absolute-path-to-keytab-file}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.token.validity&lt;/name&gt;
    &lt;value&gt;{authentication-token-validity-in-seconds}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.cookie.domain&lt;/name&gt;
    &lt;value&gt;{http-cookie-domain-for-authentication-token}&lt;/value&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.cookie.path&lt;/name&gt;
    &lt;value&gt;{http-cookie-path}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.signature.secret&lt;/name&gt;
    &lt;value&gt;{absolute-path-of-secret-file-for-signing-authentication-tokens} &lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
<p>Note that the kerberos principal for web service should begin with
HTTP/…  All the values for the properties above except for the property
<code>dt.gateway.http.authentication.type</code> should be replaced with the
appropriate values for your setup.</p>
</li>
<li>
<p>Restart the Gateway by running</p>
<p><code>sudo service dtgateway restart</code>
( when running Gateway in local mode use  <code>dtgateway restart</code> command)</p>
</li>
</ol>
<h3 id="jaas-authentication">JAAS Authentication</h3>
<p>JAAS or Java Authentication and Authorization Service is a pluggable
and extensible mechanism for authentication. It is an authentication framework
where the actual authentication is performed by a JAAS login module plugin which can be configured using a configuration file. </p>
<p>The general configuration steps for enabling any JAAS based authentication mechanism is described below. Subsequent sections will cover the specific configuration details for LDAP, Active Directory and PAM. However JAAS is not limited to just these three mechanisms. Any other JAAS compatible mechanism can be used by specifying the appropriate module in the configuration. Also if there isn't a JAAS module available for an authentication mechanism a new one can be developed using the JAAS API and used here.</p>
<p>Below are the general steps for configuring a JAAS authentication mechanism</p>
<ol>
<li>
<p>Add the following properties to <code>dt-site.xml</code> configuration file, typically located under <code>/opt/datatorrent/current/conf</code> (or <code>~/datatorrent/current/conf</code> for local install).</p>
<pre><code>&lt;configuration&gt;
    ...
  &lt;property&gt;
      &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
      &lt;value&gt;jaas&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
      &lt;name&gt;dt.gateway.http.authentication.jaas.name&lt;/name&gt;
      &lt;value&gt;name-of-jaas-module&lt;/value&gt;
  &lt;/property&gt;
    ...
&lt;/configuration&gt;
</code></pre>
<p>The <code>dt.gateway.http.authentication.jaas.name</code> property specifies the login module to use with JAAS and the next step explains the process for configuring it.</p>
</li>
<li>
<p>If the login module requires a custom callback handler it needs to be specified. What a callback handler is and how it can be specified is described in the next section <a href="#callback-handlers">Callback Handlers</a>.</p>
</li>
<li>
<p>The name of the login module specified above should be configured
    with the appropriate settings for the plugin. This is module
    specific configuration. This can be done in a file named
    .java.login.config in the home directory of the user Gateway is
    running under. If DataTorrent RTS was installed as a superuser,
    Gateway would typically run as dtadmin and this file path would
    typically be <code>/home/dtadmin/.java.login.config</code>, if running as a
    regular user it would be <code>~/.java.login.config</code>. The sample
    configurations for LDAP and PAM are shown in the next sections.</p>
</li>
<li>
<p>The classes for the login module may need to be made available to
    Gateway if they are not available in the default classpath. This can
    be done by specifying the jars containing these classes in a
    classpath variable that is used by Gateway.</p>
<p>The following step shows how to do this</p>
<p>a.  Edit the <code>custom-env.sh</code> configuration file, typically located under
    <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for
    local install) and append the list of jars obtained above to the
    DT_CLASSPATH variable. This needs to be added at the end of the
    file in the section for specifying local overrides to environment
    variables. The line would look like</p>
<p><code>export DT_CLASSPATH=${DT_CLASSPATH}:path/to/jar1:path/to/jar2:..</code></p>
</li>
<li>
<p>Restart the Gateway by running</p>
<p><code>sudo service dtgateway restart</code>
(when running Gateway in local mode use  <code>dtgateway restart</code> command)</p>
</li>
</ol>
<p>Similar to Kerberos when this authentication is enabled the first
authenticated user that accesses the system is assigned the admin role
as there are no other users in the system at this point. Any subsequent
authenticated user that access the system starts with no roles. The
admin user can then assign roles to these users. This behavior can be
changed by configuring an external role mapping. Please refer to the
<a href="#ExternalRoleMapping">External Role Mapping</a> in the <a href="#authorization-using-external-roles">Authorization using external roles</a> section below for that.  </p>
<h4 id="callback-handlers">Callback Handlers</h4>
<p>In JAAS authentication, a login module may need a custom callback to be
handled by the caller. These callbacks are typically used to provide
authentication credentials to the login module. DataTorrent RTS provides a default callback handler that handles the common callbacks but it may
not be sufficient for all login modules like in the Active Directory case described below.</p>
<p>RTS also supports specification of a custom callback handler to handle custom callbacks of a login module. The custom callback handler can be specified using the property <code>dt.gateway.http.authentication.jaas.callback.class.name</code> and when this property is not specified the default callback handler is used. The property can be specified in the <code>dt-site.xml</code> configuration file and as follows</p>
<pre><code>&lt;configuration&gt;
    ...
    &lt;property&gt; 
            &lt;name&gt;dt.gateway.http.authentication.jaas.callback.class.name&lt;/name&gt;
        &lt;value&gt;full-class-name-of-callback&lt;/value&gt;
    &lt;/property&gt;
    ...
&lt;/configuration&gt;
</code></pre>

<p>Custom callback handlers can be implemented by extending the default callback handler so they get the support for the common callbacks or they can be implemented from scratch. The Jetty callback handler described below also extends the default callback handler. The default callback handler implementation is implemented in the <code>com.datatorrent.lib.security.auth.callback.DefaultCallbackHandler</code> class available in <code>com.datatorrent:dt-library</code> artifact.</p>
<h4 id="ldap">LDAP</h4>
<p>An alternative way to enable LDAP authentication, instead of <a href="#ldap-authentication">LDAP Authentication</a> section above, is to follow the JAAS configuration steps described above with the following specific details for the individual steps.</p>
<ul>
<li>
<p>For step 1 of the JAAS authentication <a href="#enabling-jaas-auth">configuration process</a>, pick a name for the JAAS module for LDAP. You can choose a name like <code>ldap</code> that is appropriate for the current scheme. This can be done by specifying the value of the <code>dt.gateway.http.authentication.jaas.name</code> property to be <code>ldap</code>. This name should now be configured with the appropriate settings as described in the next step.</p>
</li>
<li>
<p>For step 2, no special callback handler needs to be specified as the default callback handler can handle the callbacks.</p>
</li>
<li>
<p>For step 3, the JAAS name specified above should be configured in the .java.login.config file with the appropriate LDAP settings. There are different JAAS authentication modules available for LDAP. One of them is supplied by default in Java. It is the Sun LdapLoginModule class. A sample configuration when using this module is shown below</p>
<pre><code>ldap {
  com.sun.security.auth.module.LdapLoginModule required
  userProvider="ldap://ldap-server-hostname"
  authIdentity="uid={USERNAME},ou=users,dc=domain,dc=com";
};
</code></pre>
<p>Note that the first string before the open brace, in this case
<code>ldap</code> must match the jaas name specified in step 1. The first property
<code>com.sun.security.auth.module.LdapLoginModule</code> specifies
the actual JAAS plugin implementation class providing the LDAP
authentication. The fields that appear next are LDAP settings specific to your
organization and could be different from ones shown above. The above
settings are only provided as a reference example.</p>
<p>The setting <code>authIdentity</code> is used to derive the identity of the user that will be used for authentication with the server. Here it is specifying the pattern to derive the LDAP distinguished name (dn) for the user that will be used along with the password supplied by the user for authentication with the LDAP server. The <code>{USERNAME}</code> variable in the setting will be replaced by the username specified by the user. </p>
<p>Refer to the <a href="https://docs.oracle.com/javase/7/docs/jre/api/security/jaas/spec/com/sun/security/auth/module/LdapLoginModule.html">javadoc</a> for all the configuration options available with this module.</p>
</li>
<li>
<p>For step 4, no extra jars are needed as the module is available in Java</p>
</li>
<li>
<p>Restart the gateway as described in step 5</p>
</li>
</ul>
<h4 id="active-directory">Active Directory</h4>
<p>Active Directory is used when authenting users in Microsoft Windows domains. The authentication protocol includes Microsoft's implementation of Kerberos as well as LDAP. In this section we will look into the configuration needed for LDAP authentication with Active Directory.</p>
<p>Follow the JAAS configuration steps described above with the following specific details.</p>
<ul>
<li>
<p>For step 1 of the JAAS authentication <a href="#enabling-jaas-auth">configuration process</a>, pick a name for the JAAS module. You can choose a name like <code>ad</code> that is appropriate for the current scheme. This can be done by specifying the value of the <code>dt.gateway.http.authentication.jaas.name</code> property to be <code>ad</code>. This name should now be configured with the appropriate settings as described in the next step.</p>
</li>
<li>
<p>For step 2, no special callback handler needs to be specified as the default callback handler can handle the callbacks. </p>
</li>
<li>
<p>For step 3, the JAAS name specified above should be configured with
   the appropriate Active Directory settings in the .java.login.config file. </p>
<p>In active directory authentication the user id is typically specified as <code>username@domain</code> and sometimes just <code>username</code>. Once the user is authenticated the user id needs to be mapped to the LDAP node for the user. This is done by specifying a search filter criteria which is then used to search for the user node in the directory tree starting from a specified base.</p>
<p>Below is an example showing a sample configuration for active directory authentication with the Sun LdapLoginModule</p>
<pre><code>ad {
    com.sun.security.auth.module.LdapLoginModule required
    userProvider="ldap://ad.server.com/cn=users,dc=domain,dc=com"
    userFilter="samAccountName={USERNAME}"
    authIdentity="{USERNAME}@my.domain.com";
};
</code></pre>
<p>The setting <code>userFilter</code> specifies the search criteria to look for the user in the Active Directory tree. The <code>{USERNAME}</code> variable in the setting is replaced with the username supplied by the user. The setting <code>authIdentity</code> specifies the pattern to derive the user id with the domain from the specified username.</p>
<p>The search filter can have more complex logical expressions like the one shown below</p>
<pre><code>userFilter="(&amp;(|(samAccountName={USERNAME})(userPrincipalName={USERNAME})(cn={USERNAME}))(objectClass=user))"
</code></pre>
<p>An Active Directory or a LDAP browser client can be used to browse the Active Directory to determine the correct filter to use find the users.</p>
</li>
<li>
<p>For step 4, no extra jars are needed as the module is available in Java</p>
</li>
<li>
<p>Restart the gateway as described in step 5</p>
</li>
</ul>
<h4 id="jetty-module-binding">Jetty module &amp; binding</h4>
<p>Sometimes a single <code>authIdentity</code> pattern like the one used above cannot be used to identity the users because of the way they are configured in the Active Directory, for an enterprise. An example is the case where multiple domains are being used and a single domain name cannot be specified in the <code>authIdentity</code>. </p>
<p>In those cases a fixed identity called the root identity or a system identity is used to connect to the server. Then the user node is searched with the search criteria and supplied username, from the node the user directory name is extracted and it is used along with the supplied password for the authentication.</p>
<p>A different JAAS login module that supports the system identity is needed as the Sun LdapLoginModule does not support this functionality. Jetty implements one such login module. The steps to configure this module are as follows.</p>
<ul>
<li>
<p>For step 1 of the JAAS authentication <a href="#enabling-jaas-auth">configuration process</a>, the name <code>ad</code> can be used.</p>
</li>
<li>
<p>For step 2, a special callback handler is needed to handle the Jetty module callbacks as they are not the common callbacks. There is an implementation of the callback handler for Jetty that is provided by DataTorrent RTS. It is the <code>com.datatorrent.contrib.security.jetty.JettyJAASCallbackHandler</code> class in the <code>com.datatorrent:dt-contrib</code> artifact.</p>
<p>As explained in the <a href="#callback-handlers">Callback Handlers</a> section above, the callback handler can be specified in the <code>dt-site.xml</code> config file using a property as shown below</p>
<pre><code>&lt;configuration&gt;
    ...
    &lt;property&gt; 
        &lt;name&gt;
            dt.gateway.http.authentication.jaas.callback.class.name
    &lt;/name&gt;
        &lt;value&gt;
            com.datatorrent.contrib.security.jetty.JettyJAASCallbackHandler
        &lt;/value&gt;
    &lt;/property&gt;
    ...  
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>For step 3, the configuration for the Jetty module is specified in the <code>.java.login.config</code> file. A sample configuration for this module is shown below</p>
<pre><code>ad {
    org.eclipse.jetty.plus.jaas.spi.LdapLoginModule required
    contextFactory="com.sun.jndi.ldap.LdapCtxFactory"
    hostname="ad.server.com"
    port="389"
    bindDn="serviceId@my.domain.com"
    bindPassword="Password1"
    forceBindingLogin="true"
    userBaseDn="DC=my,DC=domain,DC=com"
    userIdAttribute="samAccountName"
    userObjectClass="person";
};
</code></pre>
<p>The property <code>org.eclipse.jetty.plus.jaas.spi.LdapLoginModule</code> specifies
the actual JAAS plugin implementation class providing the LDAP authentication. The properties <code>bindDn</code> and <code>bindPassword</code> specify the directory name and password for the system identity respectively. The <code>userIdAttribute</code> and <code>userObjectClass</code> settings are used as search criteria to search for the user directory node under the <code>userBaseDn</code> path in the directory.</p>
<p>Refer to the <a href="http://archive.eclipse.org/jetty/8.1.10.v20130312/apidocs/org/eclipse/jetty/plus/jaas/spi/LdapLoginModule.html">javadoc</a> for all the configuration options available with this module.</p>
</li>
<li>
<p>The Gateway service in DataTorrent RTS 3.0 is compatible with Jetty 8. The Jetty login module in this version is in the <code>jetty-plus</code> jar. The following version <code>jetty-plus-8.1.10.v20130312.jar</code> is known to work but other compatible versions should work as well. The jar file can be obtained from the Jetty project or from <a href="https://maven-repository.com/artifact/org.eclipse.jetty/jetty-plus/8.1.10.v20130312">maven central</a>. </p>
<p>Along with the jetty jar the dt-contrib jar containing the callback handler and it's dependencies should also be included. It is available on the DataTorrent maven server <a href="https://www.datatorrent.com/maven/content/repositories/releases/com/datatorrent/dt-contrib/">here</a>.  Pick the version matching the DataTorrent RTS version you are using. The dt-contrib artifact has a dependency to <code>com.datatorrent:dt-library</code> artifact. It is also available on the maven server <a href="https://www.datatorrent.com/maven/content/repositories/releases/com/datatorrent/dt-library/">here</a>.</p>
<p>The jars can be specified in the gateway script file described in step 4 above as follows</p>
<pre><code>export DT_CLASSPATH=${DT_CLASSPATH}:path/to/jetty-plus-8.1.10.v20130312.jar:path/to/dt-contrib-&lt;version&gt;.jar:path/to/dt-library-&lt;version&gt;.jar
</code></pre>
</li>
<li>
<p>Restart the gateway as described in step 5</p>
</li>
</ul>
<h3 id="pam">PAM</h3>
<p>PAM (Pluggable Authentication Module) is a Linux system equivalent
of JAAS where applications call the generic PAM interface and the actual
authentication implementations called PAM modules are specified using
configuration files. PAM is the login authentication mechanism in Linux
so it can be used for example to authenticate and use local Linux user
accounts in Gateway. If organizations have configured other PAM modules, 
they can be used in Gateway as well.</p>
<p>PAM is implemented in C language and has a C API. JPam is a Java PAM bridge
that uses JNI to interface with PAM. It is available at
<a href="http://jpam.sourceforge.net/">JPAM website</a> and the website also has detailed documentation on how to install and set it up. JPam has a JAAS login module and hence can be used in Gateway via JAAS. Note that any other PAM implementation can be used as long as a JAAS login module is available.</p>
<p>To enable JPAM follow the JAAS configuration steps described above with the following specific details.</p>
<ul>
<li>
<p>JPAM has to be first installed on the system. Please follow the
    installation instructions from the JPAM website.</p>
</li>
<li>
<p>For step 1 of the JAAS authentication <a href="#enabling-jaas-auth">configuration process</a>, pick a name for the JPAM authentication module. You can choose a  name like <code>net-sf-jpam</code> which JPAM typically uses as the PAM configuration name. This can be done by specifying the value of the <code>dt.gateway.http.authentication.jaas.name</code> property to be <code>net-sf-jpam</code>. This name should now be configured with the appropriate settings as described in the next step.</p>
</li>
<li>
<p>For step 2, no special callback handler needs to be specified as the default callback handler can handle the callbacks </p>
</li>
<li>
<p>For step 3, the JAAS name specified above should be configured in the .java.login.config file with the appropriate JPAM settings . A
    sample configuration is shown below</p>
<pre><code>net-sf-jpam {
   net.sf.jpam.jaas.JpamLoginModule required serviceName="net-sf-jpam";
};
</code></pre>
</li>
</ul>
<p>Note that the first string before the open brace, in this case,
<code>net-sf-jpam</code> must match the jaas name specified in step 1. The first
property within the braces net.sf.jpam.jaas.JpamLoginModule specifies
the actual JAAS plugin implementation class providing the JPAM
authentication. The next settings are JPAM related settings. The setting <code>serviceName</code> specifies the PAM service which would need to be further configured in /etc/pam.d/net-sf-jpam to specify the PAM modules to use. Refer to PAM documentation on how to configure a PAM service with PAM modules. If using Linux local accounts system-auth could be specified as the PAM module in this file. The above settings are only provided as a reference example and a different name can be chosen for <code>serviceName</code>.</p>
<ul>
<li>
<p>For step 4, add the JPam jar to the DT_CLASSPATH variable. The JPam
    jar should be available in the JPam installation package and
    typically has the filename format <code>JPam-&lt;version&gt;.jar</code> where
   <code>&lt;version&gt;</code> denotes the version, version 1.1 has been tested.</p>
<pre><code>export DT_CLASSPATH=${DT_CLASSPATH}:path/to/JPam-&lt;version&gt;.jar
</code></pre>
</li>
<li>
<p>Restart the gateway as described in step 5 above    </p>
</li>
</ul>
<h3 id="group-support">Group Support</h3>
<p>For group support such as using LDAP groups for authorization refer to
the <a href="#authorization-using-external-roles">Authorization using external roles</a> section below.</p>
<h2 id="hadoop-user-mapping">Hadoop user mapping</h2>
<p>When authentication is enabled, applications are launched on the Hadoop cluster, by default, as the user matching the user name of the authenticated user. This mapping behavior, to select the user to use on the Hadoop side, is configurable and different options are available. To configure the behavior use the following setting</p>
<pre><code class="xml">&lt;property&gt;
  &lt;name&gt;dt.gateway.hadoop.user.strategy&lt;/name&gt;
  &lt;value&gt;STRATEGY&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>The <code>STRATEGY</code> in the property above identifies the mapping behavior and the following options are available</p>
<h3 id="authenticated-user">Authenticated user</h3>
<p>To specify this behavior, use <code>AUTH_USER</code> as the value for <code>STRATEGY</code>. As explained earlier, this leads to applications being launched with the same user name as the authenticated user. This is the default behavior even when the property is not specified.</p>
<p>In Kerberos secure mode, DT Gateway would still connect to Hadoop by using its Kerberos credentials, namely credentials of the user the DT Gateway service is running under (default <code>dtadmin</code>) but impersonate the authenticated user, to launch the application. This impersonation requires additional configuration on Hadoop side and it is explained in the Hadoop Configuration sub-section under the Impersonation section in the Apache Apex security <a href="https://apex.apache.org/docs/apex/security/">document</a>.</p>
<h3 id="gateway-user">Gateway user</h3>
<p>To specify this behavior, use <code>GATEWAY_USER</code> as the value for <code>STRATEGY</code>. In this mode, the Hadoop user is the same as the DT Gateway service user (default <code>dtadmin</code>) and no impersonation is necessary.</p>
<h3 id="specified-user">Specified user</h3>
<p>To specify this behavior, use <code>SPECIFIED_USER</code> as the value for <code>STRATEGY</code>. In this mode, a specific user name can be specified for the Hadoop user and it is used no matter who the authenticated user is. The Hadoop user name is specified by an additional property</p>
<pre><code class="xml">&lt;property&gt;
  &lt;name&gt;dt.gateway.hadoop.user.name&lt;/name&gt;
  &lt;value&gt;username&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>The impersonation behavior described in the <a href="#authenticated-user">Authenticated user</a> section above applies here as well and so do the requirements mentioned there.</p>
<h2 id="authorization">Authorization</h2>
<p>When any authentication method is enabled, authorization will also be
enabled.  DT Gateway uses roles and permissions for authorization.
 Permissions are possession of the authority to perform certain actions,
e.g. to launch apps, or to add users.  Roles have a collection of
permissions and individual users are assigned to one or more roles.
 What roles the user is in dictates what permissions the user has.</p>
<h3 id="permissions">Permissions</h3>
<p>The list of all possible permissions in the DT Gateway is as follow:</p>
<h4 id="access_rm_proxy">ACCESS_RM_PROXY</h4>
<p>Allow HTTP proxying requests to YARN’s Resource Manager REST API</p>
<h4 id="edit_global_config">EDIT_GLOBAL_CONFIG</h4>
<p>Edit global settings</p>
<h4 id="edit_other_users_config">EDIT_OTHER_USERS_CONFIG</h4>
<p>Edit other users’ settings</p>
<h4 id="launch_apps">LAUNCH_APPS</h4>
<p>Launch Apps</p>
<h4 id="manage_licenses">MANAGE_LICENSES</h4>
<p>Manage DataTorrent RTS licenses</p>
<h4 id="manage_other_users_apps">MANAGE_OTHER_USERS_APPS</h4>
<p>Manage (e.g. edit, kill, etc) applications launched by other users</p>
<h4 id="manage_other_users_app_packages">MANAGE_OTHER_USERS_APP_PACKAGES</h4>
<p>Manage App Packages uploaded by other users  </p>
<h4 id="manage_roles">MANAGE_ROLES</h4>
<p>Manage roles (create/delete roles, or assign permissions to roles)</p>
<h4 id="manage_system_alerts">MANAGE_SYSTEM_ALERTS</h4>
<p>Manage system alerts</p>
<h4 id="manage_users">MANAGE_USERS</h4>
<p>Manage users (create/delete users, change password)</p>
<h4 id="upload_app_packages">UPLOAD_APP_PACKAGES</h4>
<p>Upload App Packages and use the app builder</p>
<h4 id="view_global_config">VIEW_GLOBAL_CONFIG</h4>
<p>View global settings   </p>
<h4 id="view_licenses">VIEW_LICENSES</h4>
<p>View DataTorrent RTS licenses</p>
<h4 id="view_other_users_apps">VIEW_OTHER_USERS_APPS</h4>
<p>View applications launched by others</p>
<h4 id="view_other_users_app_packages">VIEW_OTHER_USERS_APP_PACKAGES</h4>
<p>View App Packages uploaded by other users</p>
<h4 id="view_other_users_config">VIEW_OTHER_USERS_CONFIG</h4>
<p>Edit other users’ settings</p>
<h4 id="view_system_alerts">VIEW_SYSTEM_ALERTS</h4>
<p>View system alerts</p>
<h3 id="default-roles">Default Roles</h3>
<p>DataTorrent RTS ships with three roles by default. The permissions for
these roles have been set accordingly but can be customized if needed.</p>
<h4 id="admin">Admin</h4>
<p>An administrator of DataTorrent RTS is intended to be able to install,
manage &amp; modify DataTorrent RTS as well as all the applications running
on it. They have ALL the permissions.</p>
<h4 id="operator">Operator</h4>
<p>Operators are intended to ensure DataTorrent RTS and the applications
running on top of it are always up and running optimally. The default
permissions assigned to Operators, enable them to effectively
troubleshoot the entire RTS system and the applications running on it.
Operators are not allowed however to develop or launch new applications.
Operators are also not allowed to make system configuration changes or
manage users.</p>
<p>Here is the list of default permissions given to operators</p>
<p><a href="#ManageSystemAlerts">MANAGE_SYSTEM_ALERTS</a></p>
<p><a href="#ViewGlobalConfig">VIEW_GLOBAL_CONFIG</a></p>
<p><a href="#ViewLicenses">VIEW_LICENSES</a></p>
<p><a href="#ViewOtherUsersApps">VIEW_OTHER_USERS_APPS</a></p>
<p><a href="#ViewOtherUsersAppPackage">VIEW_OTHER_USERS_APP_PACKAGES</a></p>
<p><a href="#ViewSystemAlerts">VIEW_SYSTEM_ALERTS</a></p>
<p>Note that VIEW_OTHER_USERS_APPS and VIEW_OTHER_USERS_APP_PACKAGES
are in the list.  This means all users in the “operator” role will have
read access to all apps and all app packages in the system.  You can
remove those permissions from the “operator” role using the Console if
this is not desirable.  </p>
<h4 id="developer">Developer</h4>
<p>Developers need to have to ability to develop, manage and run
applications on DataTorrent RTS. They are not allowed to change any
system settings or manage licenses.</p>
<p>Here is the list of default permissions given to developers</p>
<p><a href="#LaunchApps">LAUNCH_APPS</a></p>
<p><a href="#UploadAppPackages">UPLOAD_APP_PACKAGES</a></p>
<p><a href="#ManageSystemAlerts">MANAGE_SYSTEM_ALERTS</a></p>
<p><a href="#ViewGlobalConfig">VIEW_GLOBAL_CONFIG</a></p>
<p><a href="#ViewLicenses">VIEW_LICENSES</a></p>
<p><a href="#ViewSystemAlerts">VIEW_SYSTEM_ALERTS</a></p>
<h3 id="app-permissions-and-app-package-permissions">App Permissions and App Package Permissions</h3>
<p>Users can share their running application instances and their
application packages with certain roles or certain users on a
per-instance or per-package basis.  Users can specify which users or
while roles have read-only or read-write access.  In addition, users can
set their own defaults so they does not have to make permission change
every time they launch an app or uploads an app package.</p>
<p>The default for app and app package sharing is that the “operator” role
has read-only permission.</p>
<p>The Console does not yet support managing App
Permissions or App Package Permissions.  But one can manage App
Permissions and App Package Permissions using the Gateway REST API with
URI’s /ws/v2/apps/{appid}/permissions and
/ws/v2/appPackages/{user}/{name}/permissions respectively.  Please refer
to the <a href="http://docs.datatorrent.com/dtgateway_api/">DT Gateway REST API document</a> and <a href="#AdministeringUsingCommandLine">here</a> for examples on how to use the REST API.</p>
<h2 id="viewing-and-managing-auth-in-the-console">Viewing and Managing Auth in the Console</h2>
<h3 id="viewing-user-profile">Viewing User Profile</h3>
<p>After you are logged in on the Console, click on the Configuration tab
on the left, and select “User Profile”.  This gives you the information
of the logged in user, including what roles the user is in, and what
permissions the user has.
<img alt="" src="../images/GatewaySecurity/image01.png" /></p>
<h3 id="administering-auth">Administering Auth</h3>
<p>From the Configuration tab, click on “Auth Management”.  On this page,
you can perform the following tasks:</p>
<ul>
<li>Create new users</li>
<li>Delete users</li>
<li>Change existing users’ passwords</li>
<li>Assign roles to users</li>
<li>Create roles</li>
<li>Assign permissions to roles</li>
</ul>
<p><img alt="" src="../images/GatewaySecurity/image03.png" /></p>
<p>DataTorrent RTS installation comes with three preset roles (admin,
operator, and developer).  You can edit the permissions for those roles
except for admin.</p>
<h2 id="authorization-using-external-roles">Authorization using external roles</h2>
<p>When using an external authentication mechanism such as Kerberos or
JAAS, roles defined in these external systems can be used to control
authorization in DataTorrent RTS. There are two steps involved. First
support for external roles has to be configured in Gateway. This is
described below in the sections <a href="#kerberos-roles">Kerberos roles</a> and
<a href="#jaas-roles">JAAS roles</a>. Then a mapping should be specified between
the external roles and DataTorrent roles to specify which role should be
used for a user when the user logs in. How to setup this mapping is
described in the <a href="#ExternalRoleMapping">External Role Mapping</a> section below.
When this mapping is setup only users with roles that have a mapping are
allowed to login the rest are not. The next sections describe how to
configure the system for handling external roles.</p>
<h3 id="kerberos-roles">Kerberos roles</h3>
<p>When Kerberos authentication is used the role for the user is derived
from the principal. If the principal is of the form <em>user/group@DOMAIN</em>
the group portion is used as the external role and no additional
configuration is necessary.</p>
<h3 id="jaas-roles">JAAS roles</h3>
<p>To use JAAS roles the system should be configured first to recognize
these roles. When a user is authenticated with JAAS a list of principals
is returned for the user by the JAAS plugin login module. If the module supports roles then some of these principals are for roles and these role principals need to be identified from the list. Additional configuration is needed to do
this and it is specific to the login module implementation. Specifically the Java class name identifying the role principal is needed. This can be specified using the <em>dt.gateway.http.authentication.jaas.role.class.name</em> property in the <code>dt-site.xml</code> configuration file as shown below</p>
<pre><code>&lt;configuration&gt;
    ...
    &lt;property&gt;
        &lt;name&gt;dt.gateway.http.authentication.jaas.role.class.name&lt;/name&gt;
        &lt;value&gt;full-class-name-of-role&lt;/value&gt;
    &lt;/property&gt;
    ...
&lt;/configuration&gt;
</code></pre>

<h4 id="ldap-groups">LDAP Groups</h4>
<p>When using LDAP with JAAS, to utilize the LDAP roles, a LDAP login module supporting roles should be used. Any LDAP module that supports roles can be used. Jetty login module has support for roles. Refer to <a href="#jetty-module-binding">Jetty module &amp; binding</a> section above for more details about this module. The configuration steps are as follows.</p>
<ul>
<li>
<p>The Jetty login module returns the roles in role principal classes. The class name identifying the role is <code>org.eclipse.jetty.plus.jaas.JAASRole</code>. This should be specified using the <code>dt.gateway.http.authentication.jaas.role.class.name</code> property in the <code>dt-site.xml</code> configuration file as described in the section above. </p>
<p>Also as described in the <a href="#jetty-module-binding">Jetty module &amp; binding</a> section a custom callback handler is needed for the Jetty login module.</p>
<p>A sample configuration file with all the properties is shown below</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
          &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
          &lt;value&gt;jaas&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
         &lt;name&gt;dt.gateway.http.authentication.jaas.name&lt;/name&gt;
         &lt;value&gt;ldap&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;  
        &lt;name&gt;dt.gateway.http.authentication.jaas.role.class.name&lt;/name&gt;
        &lt;value&gt;org.eclipse.jetty.plus.jaas.JAASRole&lt;/value&gt;
  &lt;/property&gt;
  &lt;/property&gt;
        &lt;name&gt;
                dt.gateway.http.authentication.jaas.callback.class.name
        &lt;/name&gt;
        &lt;value&gt;
            com.datatorrent.contrib.security.jetty.JettyJAASCallbackHandler
        &lt;/value&gt;
  &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>If the system identity is used then the Jetty login module can be used as is and the jar dependencies in the step below can be specified as described in the <a href="#jetty-module-binding">Jetty module &amp; binding</a> section. </p>
<p>However, if system identity is not used something different needs to be done. An issue was discovered with the Jetty login module supplied with Jetty 8 that prevented LDAP authentication to be successful even when the user credentials were correct. DataTorrent has a fix for this and is providing the login module with the fix in a separate package called <code>dt-auth</code>. The class name for the module is <code>com.datatorrent.auth.jetty.JettyLdapLoginModule</code>. The <code>dt-auth</code> project along with the source can be found here <a href="https://github.com/DataTorrent/Auth">Auth</a>. DataTorrent is working on submitting this fix back to Jetty project so that it gets back into the main source.</p>
<p>The JAAS configuration file as described in <a href="#LDAP">LDAP</a> section under <a href="#JAAS">Enabling JAAS Auth</a> should be configured to specify the ldap settings for roles. A sample configuration containing role settings for the <code>dt-auth</code> login module is shown below. </p>
<pre><code>ldap {
    com.datatorrent.auth.jetty.JettyLdapLoginModule required
    hostname="ldap-server-hostname" port="389"
    authenticationMethod="simple" 
    userBaseDn="ou=users,dc=domain,dc=com" userIdAttribute="uid"
    userRdnAttribute="uid" roleBaseDn="ou=groups,dc=domain,dc=com"
    roleNameAttribute="cn"
    contextFactory="com.sun.jndi.ldap.LdapCtxFactory";
};
</code></pre>
<p>The <code>roleNameAttribute</code> and <code>roleBaseDn</code> settings are used to identify the role and the <code>userRdnAttribute</code> setting is used the identify the users that belong to the role. The values for these settings are dependent on attributes names are being used in your LDAP directory server.</p>
<p>Similar configuration can be used when the original Jetty login module is being used with the system id, the module class would be Jetty login module class and the binding settings would be specified as described in the <a href="#jetty-module-binding">Jetty module &amp; binding</a> section.</p>
<p>Refer to the <a href="http://archive.eclipse.org/jetty/8.1.10.v20130312/apidocs/org/eclipse/jetty/plus/jaas/spi/LdapLoginModule.html">javadoc</a> for the role and other configuration options available with this module.</p>
</li>
<li>
<p>If the Jetty login module is being used as is then the path specification instructions described in the <a href="#jetty-module-binding">Jetty module &amp; binding</a> section can be used. </p>
<p>If the login module containing the DataTorrent fix, dt-auth, is being used then it's jar along with the Jetty module dependencies containing the role class, the dt-contrib jar containing the custom callback handler along with its dependencies should all be made available for Gateway. The jars can be obtained from the <a href="https://github.com/DataTorrent/Auth">DataTorrent Auth</a> project.</p>
<p>Please follow the instructions in the above url to obtain the project jar files. After obtaining the jar files they can be specified in the gateway script file as</p>
<p><code>export DT_CLASSPATH=${DT_CLASSPATH}:path/to/jar1:path/to/jar2:..</code></p>
</li>
<li>
<p>Restart the Gateway as described earlier</p>
</li>
</ul>
<h3 id="external-role-mapping">External Role Mapping</h3>
<p>External role mapping is specified to map the external roles to the
DataTorrent roles. For example users from an LDAP group called admins
should have the admin role when using the Console. This can be specified
by doing the following steps</p>
<ol>
<li>
<p>In the configuration folder typically located under
    <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for
    local install) edit the file called external-roles or create the
    file if it not already present. In this file each line contains a
    mapping from an external role to a datatorrent role separated by a
    delimiter ‘:’ An example listing is</p>
<pre><code>admins:admin
staff:developer
</code></pre>
<p>This maps the external role admins to the DataTorrent role admin and
external role staff to the DataTorrent role developer.</p>
</li>
<li>
<p>Restart the Gateway as described earlier</p>
</li>
</ol>
<h2 id="administering-using-command-line">Administering Using Command Line</h2>
<p>You can also utilize the <a href="../dtgateway_api/">dtGateway REST API</a> (under /ws/v2/auth) to add or remove users and to change roles and passwords.
 Here are the examples with password authentication.</p>
<h3 id="log-in-as-admin">Log in as admin:</h3>
<pre><code>% curl -c ~/cookie-jar -XPOST -H "Content-Type: application/json" -d '{"userName":"admin","password":"admin"}' http://localhost:9090/ws/v2/login
</code></pre>
<p>This curl command logs in as user “admin” (with the default password
“admin”) and stores the cookie in ~/cookie-jar</p>
<h3 id="changing-the-admin-password">Changing the admin password:</h3>
<pre><code>% curl -b ~/cookie-jar -XPOST -H "Content-Type: application/json" -d '{"newPassword":"xyz"}' http://localhost:9090/ws/v2/auth/users/admin
</code></pre>
<p>This uses the “admin” credential from the cookie jar to change the password to “xyz” for user “admin”.</p>
<h3 id="adding-a-second-admin-user">Adding a second admin user:</h3>
<pre><code>% curl -b ~/cookie-jar -XPUT -H "Content-Type: application/json" -d '{"password":"abc","roles": [ "admin" ] }' http://localhost:9090/ws/v2/auth/users/john
</code></pre>
<p>This command adds a user “john” with password “abc” with admin access.</p>
<h3 id="adding-a-user-in-the-developer-role">Adding a user in the developer role:</h3>
<pre><code>% curl -b \~/cookie-jar -XPUT -H "Content-Type: application/json" -d '{"password":"abc","roles": ["developer"] (http://localhost:9090/ws/v1/login) }' http://localhost:9090/ws/v2/auth/users/jane
</code></pre>
<p>This command adds a user “jane” with password “abc” with the developer role.</p>
<h3 id="listing-all-users">Listing all users:</h3>
<pre><code>% curl -b ~/cookie-jar http://localhost:9090/ws/v2/auth/users
</code></pre>
<h3 id="getting-info-for-a-specific-user">Getting info for a specific user:</h3>
<pre><code>% curl -b ~/cookie-jar http://localhost:9090/ws/v2/auth/users/john
</code></pre>
<p>This command returns the information about the user “john”.</p>
<h3 id="removing-a-user">Removing a user:</h3>
<pre><code>% curl -b ~/cookie-jar -XDELETE http://localhost:9090/ws/v2/auth/users/jane
</code></pre>
<p>This command removes the user “jane”.</p>
<h2 id="setting-up-ssl-keystore-in-gateway">Setting up SSL Keystore in Gateway</h2>
<p>An SSL keystore is needed for your gateway to enable HTTPS in the gateway and to configure SMTP with password authentication. SMTP configuration is needed for the gateway to 
send email alerts as described in <a href="../dtgateway_systemalerts/">System Alerts</a>. </p>
<p>Follow the steps below to set up the keystore.</p>
<ol>
<li>
<p>Generate an SSL keystore if you don’t have one.  Instruction on how to generate an SSL keystore is here: <a href="http://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html">http://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html</a>.
Note down the keystore password and full path of the keystore that you need to provide in the next step.</p>
</li>
<li>
<p>Add two properties to <code>dt-site.xml</code> configuration file, typically located under <code>/opt/datatorrent/current/conf</code> (or <code>~/datatorrent/current/conf</code> for local install).</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
    &lt;!-- this is the full path to the SSL keystore you created --&gt;
      &lt;name&gt;dt.gateway.sslKeystorePath&lt;/name&gt;
      &lt;value&gt;{/path/to/keystore}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;!-- this is the keystore password --&gt;
      &lt;name&gt;dt.gateway.sslKeystorePassword&lt;/name&gt;
      &lt;value&gt;{keystore-password}&lt;/value&gt;
  &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>Perform any additional steps required for "Enabling HTTPS" or "SMTP Password Encryption" use-case as described below.</p>
</li>
<li>
<p>Restart the Gateway by running</p>
<pre><code>sudo service dtgateway restart
</code></pre>
<p>(when running Gateway in local mode use <code>dtgateway restart</code> command)</p>
</li>
</ol>
<h3 id="enabling-https-in-gateway">Enabling HTTPS in Gateway</h3>
<p>To enable HTTPS in the Gateway after setting up the keystore as described above, you have to add the following
property to the <code>dt-site.xml</code> configuration file</p>
<pre><code>    &lt;configuration&gt;
    ...
      &lt;property&gt;
        &lt;name&gt;dt.attr.GATEWAY_USE_SSL&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
      &lt;/property&gt;
    ...
    &lt;/configuration&gt;
</code></pre>
<h3 id="setting-up-a-key-for-smtp-password-encryption">Setting up a Key for SMTP Password Encryption</h3>
<p>Add another key to the keystore created above using the instructions mentioned in <a href="http://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html">http://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html</a>. For example:</p>
<pre><code>keytool -genkey -alias smtpenc-alias -keyalg RSA -keypass &lt;key password&gt; -storepass &lt;store password&gt; -keystore gwkeystore.jks
</code></pre>

<p>Note down the alias you used for the key (smtpenc-alias in the above command). Remember to use the same key password and 
store password as the ones you used in the previous command where you created the keystore.</p>
<p>Add the following property to <code>dt-site.xml</code> to indicate the alias to be used for SMTP Password Encryption:</p>
<pre><code>    &lt;configuration&gt;
    ...
     &lt;property&gt;
       &lt;name&gt;dt.gateway.ssl.alias.password.encryption&lt;/name&gt;
       &lt;value&gt;smtpenc-alias&lt;/value&gt;
     &lt;/property&gt;
    ...
    &lt;/configuration&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dtgateway_systemalerts/" class="btn btn-neutral float-right" title="System Alerts">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../configuration/" class="btn btn-neutral" title="Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../configuration/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dtgateway_systemalerts/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
