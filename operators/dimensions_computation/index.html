<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>Dimension Computation - DataTorrent Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Dimension Computation";
    var mkdocs_page_input_path = "operators/dimensions_computation.md";
    var mkdocs_page_url = "/operators/dimensions_computation/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44586211-2', 'docs.datatorrent.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DataTorrent Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">DataTorrent RTS</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Demos</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../demos/">Running Apps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../sandbox/">Sandbox</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cloud Integration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../aws_emr_manual/">AWS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../create/">Creating Applications</a>
                </li>
                <li class="">
                    
    <a class="" href="../../beginner/">Beginner's Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../../demo_videos/">Videos</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <span class="caption-text">Top N Words</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords/">Introduction</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c1/">Development Environment</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c2/">Building in Java</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c3/">Building with dtAssemble</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c4/">Monitoring with dtManage</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c5/">Visualizing with dtDashboard</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c7/">Advanced Features</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/topnwords-c6/">Appendix</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Sales Dimensions</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/salesdimensions/">Building in Java</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/salesdimensions-c2/">Building with dtAssemble</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/salesdimensions-c3/">Visualizing with dtDashboard</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../tutorials/salesdimensions-c4/">Monitoring with dtManage</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../apex_development_setup/">Apex Development Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../../configure_IDE/">Generate New Project in IDE</a>
                </li>
                <li class="">
                    
    <a class="" href="../../application_development/">Applications</a>
                </li>
                <li class="">
                    
    <a class="" href="../../application_packages/">Application Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../../configuration_packages/">Configuration Packages</a>
                </li>
                <li class="">
                    
    <a class="" href="../../operator_development/">Operators</a>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Library Operators</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../library_operators/">List of Operators</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../block_reader/">Block Reader</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../deduper/">Deduper</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Dimension Computation</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#dimensions-computation">Dimensions Computation</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#overview">Overview</a></li>
        
            <li><a class="toctree-l5" href="#key-concepts">Key Concepts</a></li>
        
            <li><a class="toctree-l5" href="#dimensions-computation-use-cases">Dimensions Computation use cases</a></li>
        
            <li><a class="toctree-l5" href="#architecture">Architecture</a></li>
        
            <li><a class="toctree-l5" href="#dimensions-computation-configuration">Dimensions Computation Configuration </a></li>
        
            <li><a class="toctree-l5" href="#visualizing-dimensions-computation">Visualizing Dimensions Computation</a></li>
        
            <li><a class="toctree-l5" href="#creating-dimensions-computation-application">Creating Dimensions Computation Application</a></li>
        
            <li><a class="toctree-l5" href="#advanced-concepts">Advanced Concepts</a></li>
        
            <li><a class="toctree-l5" href="#conclusion">Conclusion</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../file_output/">File Output</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../file_splitter/">File Splitter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../hdht/">HDHT</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../kafkaInputOperator/">Kafka Input</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../snapshot_server/">Snapshot Server</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../app_data_framework/">App Data Framework</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtgateway_api/">REST API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">App Templates</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">0.10.0</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/common/import-launch/">Import and Launch App-template</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/common/customize/">Customizing an app-template</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/database-to-database-sync/">Database-to-database-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/hdfs-line-copy/">HDFS-line-copy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/hdfs-part-file-copy/">HDFS-part-file-copy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/hdfs-to-hdfs-filter-transform/">HDFS-to-HDFS-filter-transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/kafka-to-cassandra-filter-transform/">Kafka-to-Cassandra-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/kafka-to-database-sync/">Kafka-to-Database-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/kafka-to-hdfs-filter-transform/">Kafka-to-HDFS-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/kafka-to-kafka-filter-transform/">Kafka-to-Kafka-Filter-Transform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/kinesis-to-redshift/">Kinesis-to-Redshift</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/kinesis-to-s3/">Kinesis-to-S3</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/s3-to-hdfs-sync/">S3-to-HDFS-sync</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../app-templates/0.10.0/s3-to-redshift/">S3-to-HDFS-Filter-Transform</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/database-to-hdfs/">Database dump to HDFS App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/database-to-database-sync/">Database to Database Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/hdfs-sync/">HDFS Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/hdfs-line-copy/">HDFS to HDFS Line Copy App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/hdfs-to-kafka-sync/">HDFS to Kafka Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/kafka-to-database-sync/">Kafka to Database Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/kafka-to-hdfs-filter/">Kafka to HDFS Filter App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/kafka-to-hdfs-sync/">Kafka to HDFS Sync App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/kinesis-to-s3/">Kinesis to S3 App</a>
                </li>
                <li class="">
                    
    <a class="" href="../../app-templates/s3-to-hdfs-sync/">S3 to HDFS Sync App</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../app_data_tracker/">App Data Tracker</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtingest/">dtIngest</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Platform</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../rts/">RTS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../application_configurations/">Application Configurations</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtmanage/">dtManage</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtassemble/">dtAssemble</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtdashboard/">dtDashboard</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtgateway/">dtGateway</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtgateway_systemalerts/">Alerts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../apex/">Apache Apex</a>
                </li>
                <li class="">
                    
    <a class="" href="../../apex_malhar/">Apache Apex-Malhar</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deployment and Operations</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../configuration/">Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtgateway_security/">Security</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dtgateway_systemalerts/">System Alerts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../apexcli/">Apex CLI</a>
                </li>
                <li class="">
                    
    <a class="" href="../../troubleshooting/">Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../release_notes/">Release Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../glossary/">Glossary</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../additional_docs/">Resources</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DataTorrent Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
        
          <li>Library Operators &raquo;</li>
        
      
    
    <li>Dimension Computation</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="dimensions-computation">Dimensions Computation</h1>
<p>Big data scenarios often have use-case where huge volumes of data flowing through the big data systems need to be observed for historical trends.<br />
Many applications addressing such scenarios can greatly benefit if they are equipped with the functionality of viewing historical data aggregated across time buckets. The process of receiving individual events, aggregating them over a duration, and using parameters to observe trends is referred to as <em>Dimensions Computation</em>.</p>
<p>This document provides an overview of <em>Dimensions Computation</em>, as well as instructions for using DataTorrent's operators to easily add dimensions computation to an Apache Apex application.</p>
<h2 id="overview">Overview</h2>
<h3 id="what-is-dimensions-computation">What is Dimensions Computation?</h3>
<p>Dimensions Computation is a powerful mechanism that allows for spotting trends in streaming data in real-time. This tutorial will cover the concepts behind Dimensions Computation and provide details on the process of performing Dimensions Computation. We will also show you how to use Data Torrent's out of the box operators to easily add Dimensions Computation to an application.</p>
<p><em>Dimensions Computation</em> provides a way for businesses to perform aggregations on configured numeric data. The <em>DimensionsComputation</em> operator works along with the <em>DimensionStore</em> operator, which provides the capability for applications to display historical data and trends.</p>
<h2 id="key-concepts">Key Concepts</h2>
<h4 id="key-set">Key set</h4>
<p>A key set is a set of fields in the incoming tuple that is used to combine data for aggregation.</p>
<h4 id="value-set">Value set</h4>
<p>A value set is the set of fields in the incoming tuple on which <em>Aggregator</em>(s)  are applied.</p>
<h4 id="aggregator">Aggregator</h4>
<p>An aggregator is a mathematical function that is  applied on value fields in an incoming tuple. Examples of aggregators are SUM, COUNT, MAX, MIN, and AVERAGE.</p>
<h4 id="aggregates">Aggregates</h4>
<p>Aggregates are objects containing the aggregated values for a configured value set and key combination.</p>
<h4 id="time-buckets">Time buckets</h4>
<p>Time buckets indicate the duration for which the floor time is calculated. For example, a for a time bucket of 1 minute, the floor time-value for both * 12:<strong>01:34</strong> PM * and * 12:<strong>01:59</strong> PM * will be * 12:<strong>01:00</strong> PM<em>. Similarly, for an hourly time bucket, floor time-value for * <strong>15</strong>:02:34 PM</em> and * <strong>15</strong>:34:00 PM<em> will be * <strong>15:00:00</strong> PM</em>.</p>
<p>After calculating the floor value for a duration, the time-value becomes a key. Currently supported time buckets are:  1 second, 1 minute, 1 hour, and 1 day.</p>
<h4 id="combinations">Combinations</h4>
<p>Combinations indicate a group of the keys that are used for aggregate computations.</p>
<h4 id="incremental-aggregators">Incremental <em>Aggregators</em></h4>
<p>Incremental aggregators are aggregate functions for which computations are possible only by using previous aggregate value and the new value. For example,</p>
<pre><code>SUM = {Previous_SUM} + {Current_Value}
COUNT = {Previous_COUNT}  + 1
MIN = ( {Current_Value} &lt; {Previous_MIN} ) ? {Current_Value} : {Previous_MIN}
</code></pre>

<h4 id="on-the-fly-aggregators-otf-aggregators">On-the-fly <em>Aggregators</em> (OTF Aggregators)</h4>
<p>On-the-fly aggregators are the aggregate functions that use the result of multiple incremental aggregators, and can be calculated on-the-fly if necessary. For example,</p>
<pre><code>AVERAGE = {Current_SUM} / {Current_COUNT}
</code></pre>

<h4 id="dimensionscomputation-operator">DimensionsComputation operator</h4>
<p>The DimensionsComputation operator  is an Operator that performs intermediate aggregations using incremental aggregators.</p>
<h4 id="dimensionsstore-operator">DimensionsStore operator</h4>
<p>The DimensionsStore operator  is an Operator that performs transient and final aggregations on the data generated by the Dimensions Computations operator. It maintains the historical data for aggregates to ensure a meaningful  historical view.</p>
<h2 id="dimensions-computation-use-cases">Dimensions Computation use cases</h2>
<p>Consider the case of a digital advertising publisher who receives thousands of click events every second. The history of individual clicks and impressions doesn't divulge details about users and the advertisements. A technique for deriving meaning out of such data is to observe the total number of clicks and impressions every second, minute, hour, and day. Such a technique might be  helpful for determining global trends in the advertising system, but may not provide enough granularity for localized trends. For example, the total clicks and impressions over a duration might lack in usefulness, however, the total clicks and impressions for a particular advertiser, a particular geographical area, or a combination of the two can provide actionable insight.</p>
<h2 id="architecture">Architecture</h2>
<p>Dimensions Computation requires 4 operators working in sync: DimensionsComputation, DimensionsStore, Query, and QueryResult. Given <a href="#dag">DAG</a> is for a complete Dimensions Computation application.</p>
<p>The operators within Dimensions Computation are described in detail.</p>
<h4 id="dimensionscomputation">DimensionsComputation</h4>
<p>The DimensionsComputation operator works only with incremental aggregates. The incoming data stream contains tuples that are Plain Old Java Objects (POJO), which contain data required for aggregations.
Depending on the <a href="#configuration">configuration</a>, the DimensionsComputation operator applies incremental aggregators on the value set of the tuple data within a boundary of an application window. At the end of the application window, the aggregate value is reset to calculate the new aggregates. Thus, discrete aggregates are generated by DimensionsComputation operator for every application window. This output is used by the DimensionStore operator (labeled as Store in <a href="#dag">DAG</a>) for calculating cumulative aggregates.</p>
<h4 id="dimensionsstore">DimensionsStore</h4>
<p>The DimensionsStore operator uses the discrete aggregates generated by the DimensionsComputation operator to generate cumulative aggregates in turn. Because the aggregates generated by the DimensionsComputation operator are incremental aggregates, the sum of multiple such aggregates provides cumulative aggregates as follows:</p>
<pre><code>SUM1 = SUM(Value11, Value12, ...)
SUM2 = SUM(Value21, Value22, ...)

{Cumulative_SUM} = SUM1 + SUM2
</code></pre>

<p>The DimensionsStore operator also stores transient aggregates in a persistent proprietary store called HDHT. The DimensionsStore operator uses HDHT to present the requested historical data.</p>
<h4 id="query">Query</h4>
<p>The Query operator interfaces with the <em>pubsub server</em> of <em>DataTorrent Gateway</em>. The browser creates a websocket connection with the  pubsub server hosted by DataTorrent Gateway. The Dashboard UI Widgets send queries to the pubsub server via this connection. The Query operator subscribes to the configured pubsub topic for receiving queries. These queries are parsed by the Query operator and passed onto DimensionsStore to fetch data from HDHT Store.</p>
<h4 id="queryresult">QueryResult</h4>
<p>The QueryResult operator gets the result from the DimensionsStore operator for a given query. The results are reconstructed into a format that is understood by a widget. After the results are reconstructed into the required format, they are sent to the <em>pubsub server</em> for publishing to UI widgets.</p>
<h3 id="dag">DAG <a name="dag"></a></h3>
<p><img alt="DAG" src="../images/dimensions_computation/image000.png" /></p>
<h2 id="dimensions-computation-configuration">Dimensions Computation Configuration <a name="configuration"></a></h2>
<h3 id="configuration-definitions">Configuration Definitions</h3>
<p>The configuration of Dimensions Computation is divided into: Dimensions Computation Schema Configuration and Operator Configurations as follows:</p>
<h4 id="dimensions-computation-schema-configuration">Dimensions Computation Schema Configuration</h4>
<p>The Dimensions Computation Schema provides the Dimensions Computation operator with information about the aggregations. The schema looks like this:</p>
<pre><code class="json">{&quot;keys&quot;:[{&quot;name&quot;:&quot;publisher&quot;,&quot;type&quot;:&quot;string&quot;,&quot;enumValues&quot;:[&quot;twitter&quot;,&quot;facebook&quot;,&quot;yahoo&quot;]},
         {&quot;name&quot;:&quot;advertiser&quot;,&quot;type&quot;:&quot;string&quot;,&quot;enumValues&quot;:[&quot;starbucks&quot;,&quot;safeway&quot;,&quot;mcdonalds&quot;]},
         {&quot;name&quot;:&quot;location&quot;,&quot;type&quot;:&quot;string&quot;,&quot;enumValues&quot;:[&quot;N&quot;,&quot;LREC&quot;,&quot;SKY&quot;,&quot;AL&quot;,&quot;AK&quot;]}],
 &quot;timeBuckets&quot;:[&quot;1m&quot;,&quot;1h&quot;,&quot;1d&quot;],
 &quot;values&quot;:
  [{&quot;name&quot;:&quot;impressions&quot;,&quot;type&quot;:&quot;long&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;COUNT&quot;,&quot;AVG&quot;]},
   {&quot;name&quot;:&quot;clicks&quot;,&quot;type&quot;:&quot;long&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;COUNT&quot;,&quot;AVG&quot;]},
   {&quot;name&quot;:&quot;cost&quot;,&quot;type&quot;:&quot;double&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;COUNT&quot;,&quot;AVG&quot;]},
   {&quot;name&quot;:&quot;revenue&quot;,&quot;type&quot;:&quot;double&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;COUNT&quot;,&quot;AVG&quot;]}],
 &quot;dimensions&quot;:
  [{&quot;combination&quot;:[]},
   {&quot;combination&quot;:[&quot;location&quot;]},
   {&quot;combination&quot;:[&quot;advertiser&quot;], &quot;additionalValues&quot;:[&quot;impressions:MIN&quot;, &quot;clicks:MIN&quot;, &quot;cost:MIN&quot;, &quot;revenue:MIN&quot;, &quot;impressions:MAX&quot;, &quot;clicks:MAX&quot;, &quot;cost:MAX&quot;, &quot;revenue:MAX&quot;]},
   {&quot;combination&quot;:[&quot;publisher&quot;], &quot;additionalValues&quot;:[&quot;impressions:MIN&quot;, &quot;clicks:MIN&quot;, &quot;cost:MIN&quot;, &quot;revenue:MIN&quot;, &quot;impressions:MAX&quot;, &quot;clicks:MAX&quot;, &quot;cost:MAX&quot;, &quot;revenue:MAX&quot;]},
   {&quot;combination&quot;:[&quot;advertiser&quot;,&quot;location&quot;]},
   {&quot;combination&quot;:[&quot;publisher&quot;,&quot;location&quot;]},
   {&quot;combination&quot;:[&quot;publisher&quot;,&quot;advertiser&quot;]},
   {&quot;combination&quot;:[&quot;publisher&quot;,&quot;advertiser&quot;,&quot;location&quot;]}]
}
</code></pre>

<p>The schema configuration is a JSON string that contains the following information:</p>
<ol>
<li>
<p><strong>keys:</strong> - This contains the set of keys derived from an input tuple. The <em>name</em> field stands for the name of the field from input tuple. The <em>type</em> can be defined for individual keys. The probable values for individual keys can be provided using <em>enumValues</em>.</p>
</li>
<li>
<p><strong>values:</strong> - This contains the set of fields from an input tuple on which aggregates are calculated. The <em>name</em> field stands for the name of the field from an input tuple. The <em>type</em> can be defined for individual keys. The <em>aggregators</em> can be defined separately for individual values. Only configured aggregator functions are executed on values.</p>
</li>
<li>
<p><strong>timeBuckets:</strong> - This can be used to specify the time bucket over which aggregations occur. Possible values for timeBuckets are <strong><em>"1m", "1h", "1d"</em></strong></p>
</li>
<li>
<p><strong>dimensions:</strong> - This defines the combinations of keys that are used for grouping data for aggregate calculations. This can be mentioned in <em>combination</em> with the JSON key. <em>additionalValues</em> can be used for mentioning additional aggregators for any <em>value</em>. For example, <strong>impressions:MIN</strong> indicates that for a given combination, calculate "<em>MIN</em>" for value "<em>impression</em>" as well.
By default, the down time rounded off to the next value as per time bucket is always considered as one of the keys.</p>
</li>
</ol>
<h4 id="operator-configurations">Operator Configurations</h4>
<p>Operator configurations is another set of configuration that can be used to configure individual operators.</p>
<h5 id="properties">Properties</h5>
<ol>
<li><strong>dt.operator.QueryResult.topic:</strong> - This is the name of the topic on which UI widgets listen for results.</li>
<li><strong>dt.operator.Query.topic:</strong> - his is the name of the topic on which Query operator listen for queries.</li>
<li><strong>dt.operator.QueryResult.numRetries</strong> - This property indicates the maximum number of times the QueryResult operator should retry sending data. This value is usually high.</li>
</ol>
<h5 id="attributes">Attributes</h5>
<ol>
<li><strong>dt.operator.DimensionsComputation.attr.PARTITIONER:</strong> - This attribute determines the number of  partitions for DimensionsComputation. Adding more partitions means data is  processed in parallel. If this attribute is not provided, a single partition is created. Refer to the <a href="#partitioning">Partitioning</a> section for details on partitioning.</li>
<li><strong>dt.operator.DimensionsComputation.attr.MEMORY_MB:</strong> - This attribute determines the  memory that should be assigned to the DimensionsComputations operator. If this attribute is not provided, the default value of  1 GB is used.</li>
<li><strong>dt.operator.Store.attr.MEMORY_MB:</strong> - This attribute determines the memory that should be assigned to DimensionsStore operator. If this attribute is not provided, the default value of 1 GB is used.</li>
<li><strong>dt.port.*.attr.QUEUE_CAPACITY</strong> - This attribute determines the number of tuples the buffer server can cache without blocking the input stream to the port. For peak activity, we  recommend increasing QUEUE_CAPACITY to a higher value such as 32000. If this attribute is not provided, the default value of 1024 is used.</li>
</ol>
<h2 id="visualizing-dimensions-computation">Visualizing Dimensions Computation</h2>
<p>When Dimension Computation  is launched, the visualization of aggregates over a duration can be seen by adding a widget to a dtDashboard. dtDashboard is the self-service real-time and historical data visualization interface. Rapidly gaining insight and reducing time to action provides the greatest value to an organization. DataTorrent RTS provides self-service data visualization for the business user enabling them to not only see dashboards and reports an order of magnitude faster, but to also create and share customer reports.To derive more value out of dashboards, you can add widgets to the dashboards. Widgets are charts in addition to the default charts that you can see on the dashboard.</p>
<p>And example of a Dashboard UI Widget is as follows:</p>
<p><img alt="Dashboard widgets" src="../images/dimensions_computation/image001.png" /></p>
<h2 id="creating-dimensions-computation-application">Creating Dimensions Computation Application</h2>
<p>Consider an example of the advertising publisher. Typically, an advertising publisher receives a packet of information for every event related to their  advertisements.</p>
<h3 id="sample-publisher-event">Sample publisher event</h3>
<p>An event might look like this:</p>
<pre><code class="java">public class AdEvent
{
  //The name of the company that is advertising
  public String advertiser;
  //The geographical location of the person initiating the event
  public String location;
  //How much the advertiser was charged for the event
  public double cost;
  //How much revenue was generated for the advertiser
  public double revenue;
  //The number of impressions the advertiser received from this event
  public long impressions;
  //The number of clicks the advertiser received from this event
  public long clicks;
  //The timestamp of the event in milliseconds
  public long time;

  public AdEvent() {}

  public AdEvent(String advertiser, String location, double cost, double revenue,
                 long impressions, long clicks, long time)
  {
    this.advertiser = advertiser;
    this.location = location;
    this.cost = cost;
    this.revenue = revenue;
    this.impressions = impressions;
    this.clicks = clicks;
    this.time = time;
  }

  /* Getters and setters go here */
}
</code></pre>

<h3 id="creating-an-application-using-out-of-the-box-operators">Creating an Application using out-of-the-box operators</h3>
<p>Dimensions Computation can be created using out-of-the-box operators from the Megh and Malhar library. A sample is given below:</p>
<pre><code class="java">@ApplicationAnnotation(name=&quot;AdEventDemo&quot;)
public class AdEventDemo implements StreamingApplication
{
  public static final String EVENT_SCHEMA = &quot;adsGenericEventSchema.json&quot;;

  @Override
  public void populateDAG(DAG dag, Configuration conf)
  {
    //This loads the eventSchema.json file which is a jar resource file.
    // eventSchema.json contains the Dimensions Schema using which aggregations is configured.
    String eventSchema = SchemaUtils.jarResourceFileToString(&quot;eventSchema.json&quot;);

    // Operator that receives Ad Events
    // This can be coming from any source as long as the operator can convert the data into AdEventReceiver object.
    AdEventReceiver receiver = dag.addOperator(&quot;Event Receiver&quot;, AdEventReceiver.class);

    //Adding Dimensions Computation operator into DAG.
    DimensionsComputationFlexibleSingleSchemaPOJO dimensions = dag.addOperator(&quot;DimensionsComputation&quot;, DimensionsComputationFlexibleSingleSchemaPOJO.class);

    // This defines the name present in input tuple to the name of the getter method to be used to get the value of the field.
    Map&lt;String, String&gt; keyToExpression = Maps.newHashMap();
    keyToExpression.put(&quot;advertiser&quot;, &quot;getAdvertiser()&quot;);
    keyToExpression.put(&quot;location&quot;, &quot;getLocation()&quot;);
    keyToExpression.put(&quot;time&quot;, &quot;getTime()&quot;);

    // This defines value to expression mapping for value field name to the name of the getter method to get the value of the field.
    Map&lt;String, String&gt; valueToExpression = Maps.newHashMap();
    valueToExpression.put(&quot;cost&quot;, &quot;getCost()&quot;);
    valueToExpression.put(&quot;revenue&quot;, &quot;getRevenue()&quot;);
    valueToExpression.put(&quot;impressions&quot;, &quot;getImpressions()&quot;);
    valueToExpression.put(&quot;clicks&quot;, &quot;getClicks()&quot;);

    dimensions.setKeyToExpression(keyToExpression);
    dimensions.setAggregateToExpression(aggregateToExpression);
    dimensions.setConfigurationSchemaJSON(eventSchema);

    // This configures the unifier. The purpose of this unifier is to combine the partial aggregates from different partitions of DimensionsComputation operator into single stream.
    dimensions.setUnifier(new DimensionsComputationUnifierImpl&lt;InputEvent, Aggregate&gt;());

    // Add Dimension Store operator to DAG.
    AppDataSingleSchemaDimensionStoreHDHT store = dag.addOperator(&quot;Store&quot;, AppDataSingleSchemaDimensionStoreHDHT.class);

    // This configure the Backend HDHT store of DimensionStore operator. This backend will be used to persist the Historical Aggregates Data.
    TFileImpl hdsFile = new TFileImpl.DTFileImpl();
    hdsFile.setBasePath(&quot;dataStorePath&quot;);
    store.setFileStore(hdsFile);
    store.setConfigurationSchemaJSON(eventSchema);

    // This configures the Query and QueryResult operators to the gateway address. This is needs for pubsub communication of queries/results between operators and pubsub server.
    String gatewayAddress = dag.getValue(DAG.GATEWAY_CONNECT_ADDRESS);
    URI uri = URI.create(&quot;ws://&quot; + gatewayAddress + &quot;/pubsub&quot;);
    PubSubWebSocketAppDataQuery wsIn = dag.addOperator(&quot;Query&quot;, PubSubWebSocketAppDataQuery.class);
    wsIn.setUri(uri);
    PubSubWebSocketAppDataResult wsOut = dag.addOperator(&quot;QueryResult&quot;, PubSubWebSocketAppDataResult.class);
    wsOut.setUri(uri);

    // Connecting all together.
    dag.addStream(&quot;Query&quot;, wsIn.outputPort, store.query);
    dag.addStream(&quot;QueryResult&quot;, store.queryResult, wsOut.input);
    dag.addStream(&quot;InputStream&quot;, receiver.output, dimensions.input);
    dag.addStream(&quot;DimensionalData&quot;, dimensions.output, store.input);
  }
}
</code></pre>

<h3 id="configuration-for-sample-predefined-use-cases">Configuration for Sample Predefined Use Cases</h3>
<p>The following configuration can be used for the predefined use case of the advertiser-publisher.</p>
<h4 id="dimensions-schema-configuration">Dimensions Schema Configuration</h4>
<pre><code class="json">{&quot;keys&quot;:[{&quot;name&quot;:&quot;advertiser&quot;,&quot;type&quot;:&quot;string&quot;},
         {&quot;name&quot;:&quot;location&quot;,&quot;type&quot;:&quot;string&quot;}],
 &quot;timeBuckets&quot;:[&quot;1m&quot;,&quot;1h&quot;,&quot;1d&quot;],
 &quot;values&quot;:
  [{&quot;name&quot;:&quot;impressions&quot;,&quot;type&quot;:&quot;long&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;MAX&quot;,&quot;MIN&quot;]},
   {&quot;name&quot;:&quot;clicks&quot;,&quot;type&quot;:&quot;long&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;MAX&quot;,&quot;MIN&quot;]},
   {&quot;name&quot;:&quot;cost&quot;,&quot;type&quot;:&quot;double&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;MAX&quot;,&quot;MIN&quot;]},
   {&quot;name&quot;:&quot;revenue&quot;,&quot;type&quot;:&quot;double&quot;,&quot;aggregators&quot;:[&quot;SUM&quot;,&quot;MAX&quot;,&quot;MIN&quot;]}],
 &quot;dimensions&quot;:
  [{&quot;combination&quot;:[]},
   {&quot;combination&quot;:[&quot;location&quot;]},
   {&quot;combination&quot;:[&quot;advertiser&quot;]},
   {&quot;combination&quot;:[&quot;advertiser&quot;,&quot;location&quot;]}]
}
</code></pre>

<h4 id="operator-configuration">Operator Configuration</h4>
<p><strong>Note:</strong> This operator configuration is used for an application where the input data rate is high. To sustain the load, the Dimensions Computation operator is partitioned 8 times, and the queue capacity is increased.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;configuration&gt;
  &lt;property&gt;
    &lt;name&gt;dt.operator.DimensionsComputation.attr.PARTITIONER&lt;/name&gt;
    &lt;value&gt;com.datatorrent.common.partitioner.StatelessPartitioner:8&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.operator.DimensionsComputation.attr.MEMORY_MB&lt;/name&gt;
    &lt;value&gt;16384&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
     &lt;name&gt;dt.port.*.attr.QUEUE_CAPACITY&lt;/name&gt;
     &lt;value&gt;32000&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.operator.Query.topic&lt;/name&gt;
    &lt;value&gt;AdsEventQuery&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.operator.QueryResult.topic&lt;/name&gt;
    &lt;value&gt;AdsEventQueryResult&lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>

<p>The above operator configuration is to be used for a highly loaded application where the input rate is quite high. To sustain the load, the Dimensions Computation operator is partitioned 8 times and the queue capacity is also increased.</p>
<h2 id="advanced-concepts">Advanced Concepts</h2>
<h3 id="partitioning">Partitioning <a link="partitioning"></a></h3>
<p>The Dimensions Computation operator can be statically partitioned for higher processing throughput. This can be done by adding the following attributes in the <strong>properties.xml</strong> file, or in the <strong>dt-site.xml</strong> file.</p>
<pre><code class="xml">&lt;property&gt;
  &lt;name&gt;dt.operator.DimensionsComputations.attr.PARTITIONER&lt;/name&gt;
  &lt;value&gt;com.datatorrent.common.partitioner.StatelessPartitioner:8&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>This adds the PARTITIONER attribute. This attribute creates a StatelessPartitioner for the DimensionsComputation operator. The parameter of <strong><em>8</em></strong> is going to partition the operator 8 times.
The StatelessPartitioner ensures that the operators are clones of each other. The tuples passed to individual clones of operators are decided based on the hashCode of the tuple.</p>
<p>Along with partitioned DimensionsComputation, there also comes a unifier which combines all the intermediate results from individual DimensionsComputation operators into a single stream. This stream is then passed to Dimensions Store.
Following code needs to be added in populateDAG for adding an Unifier:</p>
<pre><code class="java">DimensionsComputationFlexibleSingleSchemaPOJO dimensions = dag.addOperator(&quot;DimensionsComputation&quot;, DimensionsComputationFlexibleSingleSchemaPOJO.class);
dimensions.setUnifier(new DimensionsComputationUnifierImpl&lt;InputEvent, Aggregate&gt;());
</code></pre>

<p>Here the unifier used is <em>DimensionsComputationUnifierImpl</em> which is an out-of-the-box operator present in the DataTorrent distribution.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Aggregating huge amounts of data in real time is a major challenge that many enterprises face today. Dimension Computation provides a valuable way in which to think about the problem of aggregating data, and Data Torrent provides an implementation of of Dimension Computation that allows users to integrate data aggregation with their applications with minimal effort.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../file_output/" class="btn btn-neutral float-right" title="File Output">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../deduper/" class="btn btn-neutral" title="Deduper"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../deduper/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../file_output/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
